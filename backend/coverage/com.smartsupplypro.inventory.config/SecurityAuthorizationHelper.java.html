<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SecurityAuthorizationHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Inventory Service</a> &gt; <a href="index.source.html" class="el_package">com.smartsupplypro.inventory.config</a> &gt; <span class="el_source">SecurityAuthorizationHelper.java</span></div><h1>SecurityAuthorizationHelper.java</h1><pre class="source lang-java linenums">package com.smartsupplypro.inventory.config;

import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configurers.AuthorizeHttpRequestsConfigurer;
import org.springframework.stereotype.Component;

/**
 * Security authorization helper for HTTP request authorization rules.
 * 
 * &lt;p&gt;Centralizes authorization logic for demo mode and role-based access control.&lt;/p&gt;
 */
@Component
<span class="fc" id="L14">public class SecurityAuthorizationHelper {</span>

    /**
     * Configure URL-based authorization rules.
     *
     * @param auth         Spring Security authorization registry
     * @param demoReadonly global demo flag (currently leveraged via method security –
     *                     this method keeps URL rules simple and role-based)
     */
    public void configureAuthorization(
            AuthorizeHttpRequestsConfigurer&lt;HttpSecurity&gt;.AuthorizationManagerRequestMatcherRegistry auth,
            boolean isDemoReadonly) {
        
        /* -------------------- Public / health / OAuth2 endpoints -------------------- */

        // Health/info endpoints – keep publicly readable
<span class="fc" id="L30">        auth.requestMatchers(&quot;/actuator/health&quot;, &quot;/actuator/info&quot;).permitAll();</span>

        // Static / root / error pages (adapt if you have a different frontend setup)
<span class="fc" id="L33">        auth.requestMatchers(&quot;/&quot;, &quot;/index.html&quot;, &quot;/error&quot;).permitAll();</span>

        // OAuth2 login and logout endpoints
<span class="fc" id="L36">        auth.requestMatchers(&quot;/oauth2/**&quot;, &quot;/login/**&quot;, &quot;/logout/**&quot;).permitAll();</span>

        // If you have a public auth/user info endpoint for debugging/demo,
        // you can open it here; otherwise it will fall under /api/** below.

        /* ----------------------- Inventory API (read) ----------------------- */

        // Allow any authenticated user (including demo) to read inventory:
        // - list endpoint
        // - get-by-id
<span class="fc" id="L46">        auth.requestMatchers(HttpMethod.GET, &quot;/api/inventory&quot;, &quot;/api/inventory/**&quot;)</span>
<span class="fc" id="L47">                .authenticated();</span>

        /* ----------------------- Supplier API (read) ------------------------ */

        // Allow any authenticated user to read suppliers
<span class="fc" id="L52">        auth.requestMatchers(HttpMethod.GET, &quot;/api/suppliers&quot;, &quot;/api/suppliers/**&quot;)</span>
<span class="fc" id="L53">                .authenticated();</span>

        /* -------------------- Inventory API (mutations) --------------------- */
        // NOTE:
        // - Method-level @PreAuthorize on InventoryItemController already enforces:
        //   - create: hasRole('ADMIN') and !@securityService.isDemo()
        //   - adjustQuantity: hasAnyRole('USER','ADMIN') and !@securityService.isDemo()
        //   - changePrice: similar pattern
        // - Here we keep URL rules role-based; demo is blocked by method security.

<span class="fc" id="L63">        auth.requestMatchers(HttpMethod.POST, &quot;/api/inventory/**&quot;)</span>
<span class="fc" id="L64">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L65">        auth.requestMatchers(HttpMethod.PUT, &quot;/api/inventory/**&quot;)</span>
<span class="fc" id="L66">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L67">        auth.requestMatchers(HttpMethod.PATCH, &quot;/api/inventory/**&quot;)</span>
<span class="fc" id="L68">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L69">        auth.requestMatchers(HttpMethod.DELETE, &quot;/api/inventory/**&quot;)</span>
<span class="fc" id="L70">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>

        /* -------------------- Supplier API (mutations) ---------------------- */

<span class="fc" id="L74">        auth.requestMatchers(HttpMethod.POST, &quot;/api/suppliers/**&quot;)</span>
<span class="fc" id="L75">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L76">        auth.requestMatchers(HttpMethod.PUT, &quot;/api/suppliers/**&quot;)</span>
<span class="fc" id="L77">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L78">        auth.requestMatchers(HttpMethod.PATCH, &quot;/api/suppliers/**&quot;)</span>
<span class="fc" id="L79">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>
<span class="fc" id="L80">        auth.requestMatchers(HttpMethod.DELETE, &quot;/api/suppliers/**&quot;)</span>
<span class="fc" id="L81">                .hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;);</span>

        /* ---------------------- All other API endpoints --------------------- */

        // Everything else under /api/** requires authentication
<span class="fc" id="L86">        auth.requestMatchers(&quot;/api/**&quot;).authenticated();</span>

        // Default: everything else must be authenticated
<span class="fc" id="L89">        auth.anyRequest().authenticated();</span>
<span class="fc" id="L90">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>