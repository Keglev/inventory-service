<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ErrorResponse.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Inventory Service</a> &gt; <a href="index.source.html" class="el_package">com.smartsupplypro.inventory.exception.dto</a> &gt; <span class="el_source">ErrorResponse.java</span></div><h1>ErrorResponse.java</h1><pre class="source lang-java linenums">package com.smartsupplypro.inventory.exception.dto;

import java.time.Instant;
import java.util.concurrent.ThreadLocalRandom;

import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;

/**
 * Standardized error response builder for enterprise REST API consistency.
 *
 * &lt;p&gt;Provides immutable error response structure with correlation tracking,
 * ISO-8601 timestamps, and normalized HTTP status token mapping for reliable
 * client-side error handling across all API endpoints.
 *
 * &lt;p&gt;&lt;strong&gt;Response Structure&lt;/strong&gt;:
 * &lt;pre&gt;
 * {
 *   &quot;error&quot;: &quot;bad_request&quot;,
 *   &quot;message&quot;: &quot;Validation failed: email is required&quot;,
 *   &quot;timestamp&quot;: &quot;2025-11-14T12:34:56.789Z&quot;,
 *   &quot;correlationId&quot;: &quot;SSP-1700123456789-4523&quot;
 * }
 * &lt;/pre&gt;
 *
 * &lt;p&gt;&lt;strong&gt;Usage Example&lt;/strong&gt;:
 * &lt;pre&gt;
 * return ErrorResponse.builder()
 *     .status(HttpStatus.BAD_REQUEST)
 *     .message(&quot;Invalid email format&quot;)
 *     .build();
 * &lt;/pre&gt;
 *
 * @author Smart Supply Pro Development Team
 * @version 1.0.0
 * @since 1.0.0
 */
public class ErrorResponse {

    private final String error;
    private final String message;
    private final String timestamp;
    private final String correlationId;

<span class="fc" id="L46">    private ErrorResponse(Builder builder) {</span>
<span class="fc" id="L47">        this.error = builder.error;</span>
<span class="fc" id="L48">        this.message = builder.message;</span>
<span class="fc" id="L49">        this.timestamp = builder.timestamp;</span>
<span class="fc" id="L50">        this.correlationId = builder.correlationId;</span>
<span class="fc" id="L51">    }</span>

    /**
     * Creates a new builder instance for fluent error response construction.
     *
     * @return new ErrorResponse builder
     */
    public static Builder builder() {
<span class="fc" id="L59">        return new Builder();</span>
    }

    /**
     * Fluent builder for ErrorResponse construction with validation.
     */
<span class="fc" id="L65">    public static class Builder {</span>
        private String error;
        private String message;
        private String timestamp;
        private String correlationId;
        private HttpStatus status;

        /**
         * Sets HTTP status and derives normalized error token.
         *
         * @param status HTTP status code
         * @return this builder for chaining
         */
        public Builder status(HttpStatus status) {
<span class="fc" id="L79">            this.status = status;</span>
<span class="fc" id="L80">            this.error = status.name().toLowerCase();</span>
<span class="fc" id="L81">            return this;</span>
        }

        /**
         * Sets human-readable error message with fallback to HTTP reason phrase.
         *
         * @param message descriptive error message
         * @return this builder for chaining
         */
        public Builder message(String message) {
<span class="pc bpc" id="L91" title="2 of 4 branches missed.">            this.message = (message == null || message.isBlank()) </span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                ? (status != null ? status.getReasonPhrase() : &quot;Unknown error&quot;)</span>
<span class="fc" id="L93">                : message;</span>
<span class="fc" id="L94">            return this;</span>
        }

        /**
         * Builds ResponseEntity with JSON content type and standardized structure.
         *
         * @return complete HTTP response entity with error payload
         */
        public ResponseEntity&lt;ErrorResponse&gt; build() {
            // Auto-generate timestamp and correlation ID if not provided
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">            if (this.timestamp == null) {</span>
<span class="fc" id="L105">                this.timestamp = Instant.now().toString();</span>
            }
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">            if (this.correlationId == null) {</span>
<span class="fc" id="L108">                this.correlationId = generateCorrelationId();</span>
            }
            
<span class="fc" id="L111">            ErrorResponse response = new ErrorResponse(this);</span>
<span class="fc" id="L112">            return ResponseEntity.status(status)</span>
<span class="fc" id="L113">                    .contentType(MediaType.APPLICATION_JSON)</span>
<span class="fc" id="L114">                    .body(response);</span>
        }

        /**
         * Generates unique correlation ID for request tracking.
         *
         * @return formatted correlation ID (SSP-{timestamp}-{random})
         */
        private String generateCorrelationId() {
<span class="fc" id="L123">            return &quot;SSP-&quot; + System.currentTimeMillis() + &quot;-&quot; + </span>
<span class="fc" id="L124">                   ThreadLocalRandom.current().nextInt(1000, 9999);</span>
        }
    }

    // Getters for JSON serialization
<span class="fc" id="L129">    public String getError() { return error; }</span>
<span class="fc" id="L130">    public String getMessage() { return message; }</span>
<span class="fc" id="L131">    public String getTimestamp() { return timestamp; }</span>
<span class="fc" id="L132">    public String getCorrelationId() { return correlationId; }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>