<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Backend ¬∑ dto/stock-history-dto ¬∑ Smart Supply Pro Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS lives under /templates on GitHub Pages for inventory-service repo -->
  <link rel="stylesheet" href="/inventory-service/templates/docs.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/inventory-service/" class="logo">üì¶ Smart Supply Pro Docs</a>
      <nav class="nav">
      <a href="/inventory-service/architecture/index.html">Backend Architecture</a>
        <!-- Future: <a href="/inventory-service/frontend/architecture/overview.html">Frontend</a> -->
        <a href="/inventory-service/backend/api/index.html">Backend API</a>
        <!-- Future: <a href="/inventory-service/frontend/api/index.html">Frontend API</a> -->
        <a href="/inventory-service/backend/coverage/index.html">Backend Coverage</a>
        <!-- Future: <a href="/inventory-service/frontend/coverage/index.html">Frontend Coverage</a> -->
      </nav>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Backend</h2>
      <ul>
        <li><a href="/inventory-service/architecture/overview.html">Architecture Overview</a></li>
        <li><a href="/inventory-service/architecture/overview-de.html">Architektur-√úberblick</a></li>
        <li><a href="/inventory-service/architecture/layers/overview.html">Layers</a></li>
        <li><a href="/inventory-service/architecture/security.html">Security</a></li>
        <li><a href="/inventory-service/architecture/deployment.html">Deployment</a></li>
      </ul>

      <h2>Frontend</h2>
      <ul>
        <h3>Docs coming soon</h3>
        <!-- Future <li><a href="/inventory-service/frontend/architecture/overview.html">Architecture Overview</a></li> -->
      </ul>

      <h2>Quality</h2>
      <ul>
        <li><a href="/inventory-service/backend/api/index.html">API Reference</a></li>
        <li><a href="/inventory-service/backend/coverage/index.html">JaCoCo Coverage</a></li>
      </ul>
    </aside>

    <section class="content">
            <nav class="toc">
        <h2>On this page</h2>
        <ul>
        <li><a href="#stock-history-dtos"
        id="toc-stock-history-dtos">Stock History DTOs</a>
        <ul>
        <li><a href="#overview" id="toc-overview">Overview</a></li>
        <li><a href="#dto-diagram" id="toc-dto-diagram">DTO
        Diagram</a></li>
        <li><a href="#stockhistorydto-core-audit-record"
        id="toc-stockhistorydto-core-audit-record">StockHistoryDTO (Core
        Audit Record)</a>
        <ul>
        <li><a href="#definition"
        id="toc-definition">Definition</a></li>
        <li><a href="#field-reference" id="toc-field-reference">Field
        Reference</a></li>
        </ul></li>
        <li><a href="#stockupdateresultdto-enriched-display"
        id="toc-stockupdateresultdto-enriched-display">StockUpdateResultDTO
        (Enriched Display)</a>
        <ul>
        <li><a href="#definition-1"
        id="toc-definition-1">Definition</a></li>
        <li><a href="#field-reference-1"
        id="toc-field-reference-1">Field Reference</a></li>
        </ul></li>
        <li><a href="#stock-change-reasons"
        id="toc-stock-change-reasons">Stock Change Reasons</a></li>
        <li><a href="#requestresponse-examples"
        id="toc-requestresponse-examples">Request/Response Examples</a>
        <ul>
        <li><a href="#get-list-stock-history-paginated"
        id="toc-get-list-stock-history-paginated">GET List Stock History
        (Paginated)</a></li>
        <li><a href="#get-single-stock-history-record"
        id="toc-get-single-stock-history-record">GET Single Stock
        History Record</a></li>
        <li><a href="#get-stock-history-by-item-filtered"
        id="toc-get-stock-history-by-item-filtered">GET Stock History by
        Item (Filtered)</a></li>
        <li><a href="#get-stock-history-by-supplier-filtered"
        id="toc-get-stock-history-by-supplier-filtered">GET Stock
        History by Supplier (Filtered)</a></li>
        </ul></li>
        <li><a href="#enriched-search-response"
        id="toc-enriched-search-response">Enriched Search
        Response</a></li>
        <li><a href="#mapping-strategy"
        id="toc-mapping-strategy">Mapping Strategy</a>
        <ul>
        <li><a href="#stockhistorymapper"
        id="toc-stockhistorymapper">StockHistoryMapper</a></li>
        </ul></li>
        <li><a href="#authorization-access"
        id="toc-authorization-access">Authorization &amp; Access</a>
        <ul>
        <li><a href="#read-only-endpoint"
        id="toc-read-only-endpoint">Read-Only Endpoint</a></li>
        <li><a href="#audit-trail-immutability"
        id="toc-audit-trail-immutability">Audit Trail
        Immutability</a></li>
        </ul></li>
        <li><a href="#date-range-filtering"
        id="toc-date-range-filtering">Date Range Filtering</a></li>
        <li><a href="#testing-strategy"
        id="toc-testing-strategy">Testing Strategy</a>
        <ul>
        <li><a href="#unit-test-for-immutability"
        id="toc-unit-test-for-immutability">Unit Test for
        Immutability</a></li>
        </ul></li>
        <li><a href="#summary" id="toc-summary">Summary</a></li>
        </ul></li>
        </ul>
      </nav>
      
      <article class="doc-body">
        <p><a href="./index.html">‚¨ÖÔ∏è Back to DTO Hub</a></p>
        <h1 id="stock-history-dtos">Stock History DTOs</h1>
        <h2 id="overview">Overview</h2>
        <p>Stock History DTOs represent the immutable audit trail of
        inventory changes. All stock modifications create
        <code>StockHistory</code> records through the
        <code>StockHistoryService</code>. These DTOs are
        <strong>read-only</strong> and used exclusively for reporting
        and audit purposes.</p>
        <p><strong>Entity:</strong> <code>StockHistory</code><br />
        <strong>Mapper:</strong> <code>StockHistoryMapper</code><br />
        <strong>Controller:</strong>
        <code>StockHistoryController</code><br />
        <strong>Service:</strong> <code>StockHistoryService</code></p>
        <p><strong>Important:</strong> Stock History is append-only; no
        updates or deletions are exposed via API.</p>
        <hr />
        <h2 id="dto-diagram">DTO Diagram</h2>
        <div class="mermaid">
        graph LR
            A["API Client"]
            B["StockHistoryController"]
            
            B -->|GET List| C["Page<StockHistoryDTO>"]
            B -->|GET Single| D["StockHistoryDTO"]
            B -->|Search| E["StockUpdateResultDTO"]
            
            C --> F["StockHistoryService"]
            D --> F
            E --> F
            
            F --> G["StockHistoryMapper"]
            G --> H["StockHistory Entity"]
            
            style C fill:#c8e6c9
            style D fill:#c8e6c9
            style E fill:#c8e6c9
            style H fill:#ffccbc
        </div>
        <hr />
        <h2 id="stockhistorydto-core-audit-record">StockHistoryDTO (Core
        Audit Record)</h2>
        <h3 id="definition">Definition</h3>
        <p>Core stock change audit trail entry. Records what changed,
        when, and why.</p>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Builder</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">@NoArgsConstructor</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">@AllArgsConstructor</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StockHistoryDTO <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Unique audit record identifier<span class="co">. */</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> id<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Inventory item affected by this change<span class="co">. */</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> itemId<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Quantity delta <span class="co">(</span>positive for inbound<span class="co">,</span> negative for outbound<span class="co">). */</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> change<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Reason code for the stock change <span class="co">(</span>enum<span class="co">-</span>based<span class="co">). */</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> reason<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> User or process that triggered this change<span class="co">. */</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> createdBy<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> When this change was recorded<span class="co">. */</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> LocalDateTime timestamp<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Item price at time of change <span class="co">(</span>for value tracking<span class="co">). */</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">BigDecimal</span> priceAtChange<span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="field-reference">Field Reference</h3>
        <table>
        <colgroup>
        <col style="width: 22%" />
        <col style="width: 19%" />
        <col style="width: 35%" />
        <col style="width: 22%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Field</th>
        <th>Type</th>
        <th>Read-Only</th>
        <th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code>id</code></td>
        <td>String</td>
        <td>Yes</td>
        <td>System-generated unique identifier</td>
        </tr>
        <tr class="even">
        <td><code>itemId</code></td>
        <td>String</td>
        <td>Yes</td>
        <td>Foreign key to InventoryItem</td>
        </tr>
        <tr class="odd">
        <td><code>change</code></td>
        <td>int</td>
        <td>Yes</td>
        <td>Quantity delta: positive (inbound), negative (outbound)</td>
        </tr>
        <tr class="even">
        <td><code>reason</code></td>
        <td>String</td>
        <td>Yes</td>
        <td>Reason code (e.g., ‚Äúreceived‚Äù, ‚Äúsold_to_customer‚Äù)</td>
        </tr>
        <tr class="odd">
        <td><code>createdBy</code></td>
        <td>String</td>
        <td>Yes</td>
        <td>User or process creating this record</td>
        </tr>
        <tr class="even">
        <td><code>timestamp</code></td>
        <td>LocalDateTime</td>
        <td>Yes</td>
        <td>When the change occurred (ISO-8601 UTC)</td>
        </tr>
        <tr class="odd">
        <td><code>priceAtChange</code></td>
        <td>BigDecimal</td>
        <td>Yes</td>
        <td>Historical price for value tracking</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <h2
        id="stockupdateresultdto-enriched-display">StockUpdateResultDTO
        (Enriched Display)</h2>
        <h3 id="definition-1">Definition</h3>
        <p>Enhanced stock history with human-readable item and supplier
        names. Used for display and export.</p>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">@AllArgsConstructor</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StockUpdateResultDTO <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Item display name <span class="co">(</span>enriched from ID<span class="co">). */</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> itemName<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Supplier display name <span class="co">(</span>enriched from ID<span class="co">). */</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> supplierName<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Quantity delta <span class="co">(</span>positive inbound<span class="co">,</span> negative outbound<span class="co">). */</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> change<span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Stock change reason classification<span class="co">. */</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> reason<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> User or process that triggered this change<span class="co">. */</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> createdBy<span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> When this change was recorded<span class="co">. */</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> LocalDateTime timestamp<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span> Item price at time of change <span class="co">(</span>for value tracking<span class="co">). */</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">BigDecimal</span> priceAtChange<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="field-reference-1">Field Reference</h3>
        <table style="width:100%;">
        <colgroup>
        <col style="width: 35%" />
        <col style="width: 30%" />
        <col style="width: 35%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Field</th>
        <th>Type</th>
        <th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code>itemName</code></td>
        <td>String</td>
        <td>Human-readable item name (enriched from InventoryItem)</td>
        </tr>
        <tr class="even">
        <td><code>supplierName</code></td>
        <td>String</td>
        <td>Human-readable supplier name (enriched from Supplier)</td>
        </tr>
        <tr class="odd">
        <td><code>change</code></td>
        <td>int</td>
        <td>Quantity delta</td>
        </tr>
        <tr class="even">
        <td><code>reason</code></td>
        <td>String</td>
        <td>Reason code</td>
        </tr>
        <tr class="odd">
        <td><code>createdBy</code></td>
        <td>String</td>
        <td>User or process</td>
        </tr>
        <tr class="even">
        <td><code>timestamp</code></td>
        <td>LocalDateTime</td>
        <td>When the change occurred</td>
        </tr>
        <tr class="odd">
        <td><code>priceAtChange</code></td>
        <td>BigDecimal</td>
        <td>Historical price</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <h2 id="stock-change-reasons">Stock Change Reasons</h2>
        <p>All stock changes are categorized by reason code:</p>
        <table>
        <colgroup>
        <col style="width: 13%" />
        <col style="width: 28%" />
        <col style="width: 23%" />
        <col style="width: 34%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Code</th>
        <th>Description</th>
        <th>Direction</th>
        <th>Typical Actor</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code>received</code></td>
        <td>Stock received from supplier</td>
        <td>Inbound (+)</td>
        <td>Warehouse staff</td>
        </tr>
        <tr class="even">
        <td><code>sold_to_customer</code></td>
        <td>Sold to customer</td>
        <td>Outbound (-)</td>
        <td>Sales/Fulfillment</td>
        </tr>
        <tr class="odd">
        <td><code>return_from_customer</code></td>
        <td>Return from customer</td>
        <td>Inbound (+)</td>
        <td>Warehouse staff</td>
        </tr>
        <tr class="even">
        <td><code>damaged</code></td>
        <td>Damaged and removed</td>
        <td>Outbound (-)</td>
        <td>Quality control</td>
        </tr>
        <tr class="odd">
        <td><code>inventory_adjustment</code></td>
        <td>Manual count adjustment</td>
        <td>Both ¬±0</td>
        <td>Audit/Management</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <h2 id="requestresponse-examples">Request/Response Examples</h2>
        <h3 id="get-list-stock-history-paginated">GET List Stock History
        (Paginated)</h3>
        <p><strong>Request:</strong></p>
        <pre class="http"><code>GET /api/stock-history?page=0&amp;size=20&amp;sort=timestamp,desc
Authorization: Bearer &lt;token&gt;</code></pre>
        <p><strong>Response (200 OK):</strong></p>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00042&quot;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-001&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;received&quot;</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;warehouse@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T14:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00041&quot;</span><span class="fu">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-002&quot;</span><span class="fu">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">-20</span><span class="fu">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;sold_to_customer&quot;</span><span class="fu">,</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;sales@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T13:15:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">29.99</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00040&quot;</span><span class="fu">,</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-001&quot;</span><span class="fu">,</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">-5</span><span class="fu">,</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;damaged&quot;</span><span class="fu">,</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;qc@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T10:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pageable&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pageNumber&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pageSize&quot;</span><span class="fu">:</span> <span class="dv">20</span><span class="fu">,</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sort&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="fu">{</span> <span class="dt">&quot;property&quot;</span><span class="fu">:</span> <span class="st">&quot;timestamp&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;DESC&quot;</span> <span class="fu">}</span> <span class="ot">]</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalElements&quot;</span><span class="fu">:</span> <span class="dv">5420</span><span class="fu">,</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalPages&quot;</span><span class="fu">:</span> <span class="dv">271</span><span class="fu">,</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;last&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <h3 id="get-single-stock-history-record">GET Single Stock
        History Record</h3>
        <p><strong>Request:</strong></p>
        <pre class="http"><code>GET /api/stock-history/SH-00042
Authorization: Bearer &lt;token&gt;</code></pre>
        <p><strong>Response (200 OK):</strong></p>
        <div class="sourceCode" id="cb6"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00042&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-001&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;received&quot;</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;warehouse@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T14:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <h3 id="get-stock-history-by-item-filtered">GET Stock History by
        Item (Filtered)</h3>
        <p><strong>Request:</strong></p>
        <pre class="http"><code>GET /api/stock-history/by-item/ITEM-001?page=0&amp;size=50
Authorization: Bearer &lt;token&gt;</code></pre>
        <p><strong>Response (200 OK):</strong></p>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00042&quot;</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-001&quot;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;received&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;warehouse@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T14:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;SH-00039&quot;</span><span class="fu">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;itemId&quot;</span><span class="fu">:</span> <span class="st">&quot;ITEM-001&quot;</span><span class="fu">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">-30</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;sold_to_customer&quot;</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;sales@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T09:45:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pageable&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="er">...</span> <span class="fu">},</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalElements&quot;</span><span class="fu">:</span> <span class="dv">287</span><span class="fu">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalPages&quot;</span><span class="fu">:</span> <span class="dv">6</span><span class="fu">,</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;last&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <h3 id="get-stock-history-by-supplier-filtered">GET Stock
        History by Supplier (Filtered)</h3>
        <p><strong>Request:</strong></p>
        <pre class="http"><code>GET /api/stock-history/by-supplier/SUP-001?page=0&amp;size=100
Authorization: Bearer &lt;token&gt;</code></pre>
        <p><strong>Response (200 OK):</strong></p>
        <p>Returns all stock history records for items from the
        specified supplier.</p>
        <hr />
        <h2 id="enriched-search-response">Enriched Search Response</h2>
        <p>When using search endpoints, results return enriched
        <code>StockUpdateResultDTO</code>:</p>
        <p><strong>Request:</strong></p>
        <pre class="http"><code>POST /api/stock-history/search
Content-Type: application/json
Authorization: Bearer &lt;token&gt;

{
  &quot;itemId&quot;: &quot;ITEM-001&quot;,
  &quot;reason&quot;: &quot;received&quot;,
  &quot;startDate&quot;: &quot;2025-11-01&quot;,
  &quot;endDate&quot;: &quot;2025-11-30&quot;
}</code></pre>
        <p><strong>Response (200 OK):</strong></p>
        <div class="sourceCode" id="cb11"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;itemName&quot;</span><span class="fu">:</span> <span class="st">&quot;Widget A&quot;</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;supplierName&quot;</span><span class="fu">:</span> <span class="st">&quot;ACME Corp&quot;</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;received&quot;</span><span class="fu">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;warehouse@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-19T14:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;itemName&quot;</span><span class="fu">:</span> <span class="st">&quot;Widget A&quot;</span><span class="fu">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;supplierName&quot;</span><span class="fu">:</span> <span class="st">&quot;ACME Corp&quot;</span><span class="fu">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;change&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;received&quot;</span><span class="fu">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;createdBy&quot;</span><span class="fu">:</span> <span class="st">&quot;warehouse@company.com&quot;</span><span class="fu">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-12T08:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;priceAtChange&quot;</span><span class="fu">:</span> <span class="fl">19.85</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
        <hr />
        <h2 id="mapping-strategy">Mapping Strategy</h2>
        <h3 id="stockhistorymapper">StockHistoryMapper</h3>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StockHistoryMapper <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> InventoryItemRepository itemRepository<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> SupplierRepository supplierRepository<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Convert StockHistory entity to core DTO<span class="co">.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> StockHistoryDTO <span class="fu">toDTO</span><span class="op">(</span>StockHistory entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>entity <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> StockHistoryDTO<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">id</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getId</span><span class="op">())</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">itemId</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getItemId</span><span class="op">())</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">change</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getChange</span><span class="op">())</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">reason</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getReason</span><span class="op">().</span><span class="fu">getValue</span><span class="op">())</span>  <span class="co">// Enum to string</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createdBy</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getCreatedBy</span><span class="op">())</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">timestamp</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getTimestamp</span><span class="op">())</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">priceAtChange</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getPriceAtChange</span><span class="op">())</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Convert to enriched result with display names<span class="co">.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> StockUpdateResultDTO <span class="fu">toEnrichedDTO</span><span class="op">(</span>StockHistory entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>entity <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        InventoryItem item <span class="op">=</span> itemRepository<span class="op">.</span><span class="fu">findById</span><span class="op">(</span>entity<span class="op">.</span><span class="fu">getItemId</span><span class="op">())</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">orElse</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        Supplier supplier <span class="op">=</span> item <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> supplierRepository<span class="op">.</span><span class="fu">findById</span><span class="op">(</span>item<span class="op">.</span><span class="fu">getSupplierId</span><span class="op">()).</span><span class="fu">orElse</span><span class="op">(</span><span class="kw">null</span><span class="op">)</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="fu">StockUpdateResultDTO</span><span class="op">(</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            item <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> item<span class="op">.</span><span class="fu">getName</span><span class="op">()</span> <span class="op">:</span> entity<span class="op">.</span><span class="fu">getItemId</span><span class="op">(),</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            supplier <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> supplier<span class="op">.</span><span class="fu">getName</span><span class="op">()</span> <span class="op">:</span> <span class="st">&quot;Unknown&quot;</span><span class="op">,</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>            entity<span class="op">.</span><span class="fu">getChange</span><span class="op">(),</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>            entity<span class="op">.</span><span class="fu">getReason</span><span class="op">().</span><span class="fu">getValue</span><span class="op">(),</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>            entity<span class="op">.</span><span class="fu">getCreatedBy</span><span class="op">(),</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>            entity<span class="op">.</span><span class="fu">getTimestamp</span><span class="op">(),</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>            entity<span class="op">.</span><span class="fu">getPriceAtChange</span><span class="op">()</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Convert list of entities to DTOs<span class="co">.</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>StockHistoryDTO<span class="op">&gt;</span> <span class="fu">toDTOList</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>StockHistory<span class="op">&gt;</span> entities<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> entities<span class="op">.</span><span class="fu">stream</span><span class="op">()</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>toDTO<span class="op">)</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">collect</span><span class="op">(</span>Collectors<span class="op">.</span><span class="fu">toList</span><span class="op">());</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="authorization-access">Authorization &amp; Access</h2>
        <h3 id="read-only-endpoint">Read-Only Endpoint</h3>
        <p>All stock history endpoints are read-only (no
        POST/PUT/DELETE):</p>
        <div class="sourceCode" id="cb13"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;/api/stock-history&quot;</span><span class="op">)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">@RequiredArgsConstructor</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StockHistoryController <span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;isAuthenticated() or @appProperties.demoReadonly&quot;</span><span class="op">)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>Page<span class="op">&lt;</span>StockHistoryDTO<span class="op">&gt;&gt;</span> <span class="fu">list</span><span class="op">(</span><span class="kw">...</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// GET allowed</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;isAuthenticated() or @appProperties.demoReadonly&quot;</span><span class="op">)</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>StockHistoryDTO<span class="op">&gt;</span> <span class="fu">get</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// GET allowed</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="audit-trail-immutability">Audit Trail Immutability</h3>
        <p>Stock history records are created automatically when:</p>
        <ol type="1">
        <li>Items are created (initial quantity recorded)</li>
        <li>Stock updates via
        <code>PATCH /api/items/{id}/update-stock</code></li>
        <li>Inventory adjustments via manual operations</li>
        </ol>
        <p><strong>No API to modify/delete stock history.</strong>
        Immutability ensures audit trail integrity.</p>
        <hr />
        <h2 id="date-range-filtering">Date Range Filtering</h2>
        <p>For analytics and reporting, filter by date range:</p>
        <p><strong>Query Parameters:</strong></p>
        <table>
        <thead>
        <tr class="header">
        <th>Parameter</th>
        <th>Type</th>
        <th>Example</th>
        <th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code>startDate</code></td>
        <td>Date</td>
        <td><code>2025-11-01</code></td>
        <td>ISO format <code>yyyy-MM-dd</code></td>
        </tr>
        <tr class="even">
        <td><code>endDate</code></td>
        <td>Date</td>
        <td><code>2025-11-30</code></td>
        <td>ISO format <code>yyyy-MM-dd</code></td>
        </tr>
        <tr class="odd">
        <td><code>itemId</code></td>
        <td>String</td>
        <td><code>ITEM-001</code></td>
        <td>Filter by item (optional)</td>
        </tr>
        <tr class="even">
        <td><code>reason</code></td>
        <td>String</td>
        <td><code>received</code></td>
        <td>Filter by reason (optional)</td>
        </tr>
        </tbody>
        </table>
        <p><strong>Example Request:</strong></p>
        <pre class="http"><code>GET /api/stock-history?startDate=2025-11-01&amp;endDate=2025-11-30&amp;reason=received&amp;page=0&amp;size=100
Authorization: Bearer &lt;token&gt;</code></pre>
        <hr />
        <h2 id="testing-strategy">Testing Strategy</h2>
        <h3 id="unit-test-for-immutability">Unit Test for
        Immutability</h3>
        <div class="sourceCode" id="cb15"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">@WebMvcTest</span><span class="op">(</span>StockHistoryController<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StockHistoryControllerTest <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testGetStockHistory_ReturnsDTO</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        StockHistoryDTO mockHistory <span class="op">=</span> StockHistoryDTO<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">id</span><span class="op">(</span><span class="st">&quot;SH-00042&quot;</span><span class="op">)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">itemId</span><span class="op">(</span><span class="st">&quot;ITEM-001&quot;</span><span class="op">)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">change</span><span class="op">(</span><span class="dv">50</span><span class="op">)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">reason</span><span class="op">(</span><span class="st">&quot;received&quot;</span><span class="op">)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createdBy</span><span class="op">(</span><span class="st">&quot;warehouse@company.com&quot;</span><span class="op">)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">timestamp</span><span class="op">(</span>LocalDateTime<span class="op">.</span><span class="fu">now</span><span class="op">())</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">priceAtChange</span><span class="op">(</span><span class="bu">BigDecimal</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span><span class="fl">19.99</span><span class="op">))</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">when</span><span class="op">(</span>stockHistoryService<span class="op">.</span><span class="fu">getById</span><span class="op">(</span><span class="st">&quot;SH-00042&quot;</span><span class="op">))</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">thenReturn</span><span class="op">(</span>Optional<span class="op">.</span><span class="fu">of</span><span class="op">(</span>mockHistory<span class="op">));</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        mockMvc<span class="op">.</span><span class="fu">perform</span><span class="op">(</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;/api/stock-history/SH-00042&quot;</span><span class="op">))</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">status</span><span class="op">().</span><span class="fu">isOk</span><span class="op">())</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">jsonPath</span><span class="op">(</span><span class="st">&quot;$.itemId&quot;</span><span class="op">).</span><span class="fu">value</span><span class="op">(</span><span class="st">&quot;ITEM-001&quot;</span><span class="op">))</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">jsonPath</span><span class="op">(</span><span class="st">&quot;$.change&quot;</span><span class="op">).</span><span class="fu">value</span><span class="op">(</span><span class="dv">50</span><span class="op">));</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testPostStockHistory_Returns405MethodNotAllowed</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// POST should be forbidden</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        mockMvc<span class="op">.</span><span class="fu">perform</span><span class="op">(</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">post</span><span class="op">(</span><span class="st">&quot;/api/stock-history&quot;</span><span class="op">)</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON</span><span class="op">)</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">content</span><span class="op">(</span><span class="st">&quot;{}&quot;</span><span class="op">)</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">status</span><span class="op">().</span><span class="fu">isMethodNotAllowed</span><span class="op">());</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="summary">Summary</h2>
        <table>
        <colgroup>
        <col style="width: 50%" />
        <col style="width: 50%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Aspect</th>
        <th>Detail</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><strong>Core DTO</strong></td>
        <td><code>StockHistoryDTO</code> (raw audit record)</td>
        </tr>
        <tr class="even">
        <td><strong>Enriched DTO</strong></td>
        <td><code>StockUpdateResultDTO</code> (with display names)</td>
        </tr>
        <tr class="odd">
        <td><strong>Entity</strong></td>
        <td><code>StockHistory</code></td>
        </tr>
        <tr class="even">
        <td><strong>Mapper</strong></td>
        <td><code>StockHistoryMapper</code></td>
        </tr>
        <tr class="odd">
        <td><strong>Controller</strong></td>
        <td><code>StockHistoryController</code></td>
        </tr>
        <tr class="even">
        <td><strong>Operations</strong></td>
        <td>READ-ONLY (no create/update/delete via API)</td>
        </tr>
        <tr class="odd">
        <td><strong>Authorization</strong></td>
        <td>Authenticated or demo mode (read-only safe)</td>
        </tr>
        <tr class="even">
        <td><strong>Immutability</strong></td>
        <td>Records created automatically, never modified</td>
        </tr>
        <tr class="odd">
        <td><strong>Audit Trail</strong></td>
        <td>Every stock change recorded with timestamp, user,
        reason</td>
        </tr>
        <tr class="even">
        <td><strong>Filtering</strong></td>
        <td>By item, supplier, date range, reason</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <p><a href="./index.html">‚¨ÖÔ∏è Back to DTO Hub</a></p>
      </article>
    </section>
  </main>

  <footer class="footer">
    Smart Supply Pro ¬∑ Generated by Docs Pipeline
  </footer>

  <!-- Mermaid for diagrams in ```mermaid``` blocks -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>
</body>
</html>
