<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Backend ¬∑ testing/test-fixtures ¬∑ Smart Supply Pro Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS lives under /templates on GitHub Pages for inventory-service repo -->
  <link rel="stylesheet" href="/inventory-service/templates/docs.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/inventory-service/" class="logo">üì¶ Smart Supply Pro Docs</a>
      <nav class="nav">
      <a href="/inventory-service/architecture/index.html">Backend Architecture</a>
      <a href="/inventory-service/architecture/overview-de.html">Backend Architektur Deutsch</a>
      <a href="/inventory-service/frontend/architecture/index.html">Frontend Architecture</a>
      <a href="/inventory-service/backend/api/index.html">Backend API</a>
      <a href="/inventory-service/frontend/api/index.html">Frontend API</a>
      <a href="/inventory-service/backend/coverage/index.html">Backend Coverage</a>  
      <a href="/inventory-service/frontend/coverage/index.html">Frontend Coverage</a>
      </nav>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Backend</h2>
      <ul>
        <li><a href="/inventory-service/architecture/overview.html">Architecture Overview</a></li>
        <li><a href="/inventory-service/architecture/overview-de.html">Architektur-√úberblick</a></li>
        <li><a href="/inventory-service/architecture/layers/overview.html">Layers</a></li>
        <li><a href="/inventory-service/architecture/model/index.html">Data Models</a></li>
        <li><a href="/inventory-service/architecture/enums/index.html">Enums</a></li>
        <li><a href="/inventory-service/architecture/dto/index.html">DTOs</a></li>
        <li><a href="/inventory-service/architecture/config/index.html">Config</a></li>
        <li><a href="/inventory-service/architecture/controller/index.html">Controllers</a></li>
        <li><a href="/inventory-service/architecture/security/index.html">Security</a></li>
        <li><a href="/inventory-service/architecture/deployment/index.html">Deployment</a></li>
        <li><a href="/inventory-service/architecture/exception/index.html">Exception Handling</a></li>
        <li><a href="/inventory-service/architecture/integration/index.html">Integration</a></li>
        <li><a href="/inventory-service/architecture/repository/index.html">Repository</a></li>
        <li><a href="/inventory-service/architecture/resources/index.html">Resources</a></li>
        <li><a href="/inventory-service/architecture/validation/index.html">Validation</a></li>
        <li><a href="/inventory-service/architecture/testing/index.html">Testing</a></li>
        <li><a href="/inventory-service/architecture/diagrams/index.html">Diagrams</a></li>
      </ul>

      <h2>Frontend</h2>
      <ul>
        <h3>Docs coming soon</h3>
        <!-- Future <li><a href="/inventory-service/frontend/architecture/overview.html">Architecture Overview</a></li> -->
      </ul>

      <h2>Quality</h2>
      <ul>
        <li><a href="/inventory-service/backend/api/index.html">API Reference</a></li>
        <li><a href="/inventory-service/backend/coverage/index.html">JaCoCo Coverage</a></li>
      </ul>
    </aside>

    <section class="content">
            <nav class="toc">
        <h2>On this page</h2>
        <ul>
        <li><a href="#test-fixtures-data-builders"
        id="toc-test-fixtures-data-builders">Test Fixtures &amp; Data
        Builders</a>
        <ul>
        <li><a href="#table-of-contents"
        id="toc-table-of-contents">Table of Contents</a></li>
        <li><a href="#test-helper-pattern"
        id="toc-test-helper-pattern">Test Helper Pattern</a></li>
        <li><a href="#inventoryitemserviceimpltesthelper"
        id="toc-inventoryitemserviceimpltesthelper">InventoryItemServiceImplTestHelper</a>
        <ul>
        <li><a href="#method-1-authenticateasoauth2username-roles..."
        id="toc-method-1-authenticateasoauth2username-roles...">Method
        1:
        <code>authenticateAsOAuth2(username, roles...)</code></a></li>
        <li><a href="#method-2-mockoauth2authenticationemail-roles..."
        id="toc-method-2-mockoauth2authenticationemail-roles...">Method
        2:
        <code>mockOAuth2Authentication(email, roles...)</code></a></li>
        </ul></li>
        <li><a href="#oauth2-authentication-setup"
        id="toc-oauth2-authentication-setup">OAuth2 Authentication
        Setup</a>
        <ul>
        <li><a
        href="#how-authenticateasoauth2-maps-to-real-authentication"
        id="toc-how-authenticateasoauth2-maps-to-real-authentication">How
        <code>authenticateAsOAuth2()</code> Maps to Real
        Authentication</a></li>
        <li><a href="#why-both-role-formats"
        id="toc-why-both-role-formats">Why Both Role Formats?</a></li>
        </ul></li>
        <li><a href="#test-data-builders"
        id="toc-test-data-builders">Test Data Builders</a>
        <ul>
        <li><a href="#pattern-object-builders-for-test-data"
        id="toc-pattern-object-builders-for-test-data">Pattern: Object
        Builders for Test Data</a></li>
        <li><a href="#creating-test-specific-builders"
        id="toc-creating-test-specific-builders">Creating Test-Specific
        Builders</a></li>
        </ul></li>
        <li><a href="#test-isolation-cleanup"
        id="toc-test-isolation-cleanup">Test Isolation &amp; Cleanup</a>
        <ul>
        <li><a href="#automatic-cleanup-with-datajpatest"
        id="toc-automatic-cleanup-with-datajpatest">Automatic Cleanup
        with <span class="citation"
        data-cites="DataJpaTest">@DataJpaTest</span></a></li>
        <li><a href="#manual-cleanup-with-beforeeach"
        id="toc-manual-cleanup-with-beforeeach">Manual Cleanup with
        <span class="citation"
        data-cites="BeforeEach">@BeforeEach</span></a></li>
        <li><a href="#test-order-independence"
        id="toc-test-order-independence">Test Order
        Independence</a></li>
        <li><a href="#securitycontextholder-cleanup"
        id="toc-securitycontextholder-cleanup">SecurityContextHolder
        Cleanup</a></li>
        </ul></li>
        <li><a href="#best-practices" id="toc-best-practices">Best
        Practices</a>
        <ul>
        <li><a href="#use-helpers-for-repetitive-setup"
        id="toc-use-helpers-for-repetitive-setup">1. Use Helpers for
        Repetitive Setup</a></li>
        <li><a href="#name-test-helpers-descriptively"
        id="toc-name-test-helpers-descriptively">2. Name Test Helpers
        Descriptively</a></li>
        <li><a href="#make-helpers-stateless"
        id="toc-make-helpers-stateless">3. Make Helpers
        Stateless</a></li>
        <li><a href="#document-why-helpers-exist"
        id="toc-document-why-helpers-exist">4. Document Why Helpers
        Exist</a></li>
        <li><a href="#keep-builders-simple"
        id="toc-keep-builders-simple">5. Keep Builders Simple</a></li>
        </ul></li>
        <li><a href="#summary" id="toc-summary">Summary</a></li>
        <li><a href="#see-also" id="toc-see-also">See Also</a></li>
        </ul></li>
        </ul>
      </nav>
      
      <article class="doc-body">
        <h1 id="test-fixtures-data-builders">Test Fixtures &amp; Data
        Builders</h1>
        <p><strong>Overview:</strong> This document explains test helper
        patterns, data builders, and fixture management used throughout
        the inventory service test suite.</p>
        <hr />
        <h2 id="table-of-contents">Table of Contents</h2>
        <ol type="1">
        <li><a href="#test-helper-pattern">Test Helper Pattern</a></li>
        <li><a
        href="#inventoryitemserviceimpltesthelper">InventoryItemServiceImplTestHelper</a></li>
        <li><a href="#oauth2-authentication-setup">OAuth2 Authentication
        Setup</a></li>
        <li><a href="#test-data-builders">Test Data Builders</a></li>
        <li><a href="#test-isolation--cleanup">Test Isolation &amp;
        Cleanup</a></li>
        <li><a href="#best-practices">Best Practices</a></li>
        </ol>
        <hr />
        <h2 id="test-helper-pattern">Test Helper Pattern</h2>
        <p><strong>Definition:</strong> A test helper is a utility class
        that provides shared test setup logic across multiple test
        classes.</p>
        <p><strong>Purpose:</strong> - Reduce code duplication in test
        setup - Provide consistent test authentication/authorization -
        Encapsulate complex initialization logic - Make test classes
        more readable</p>
        <p><strong>Design Principles:</strong> - Keep helpers
        <strong>stateless</strong> (no instance variables) - Use
        <code>final class</code> with private constructor to prevent
        instantiation - Mark methods as <code>static</code> for direct
        access without object creation - Add comprehensive JavaDoc
        explaining <strong>why</strong> the helper exists and
        <strong>what</strong> it does</p>
        <p><strong>Example Structure:</strong></p>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Shared helper methods for InventoryItemServiceImpl test classes<span class="co">.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Purpose<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Provides OAuth2 authentication setup for test security context<span class="co">.</span><span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Simplifies mocking of authenticated user scenarios<span class="co">.</span><span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="kw">class</span> InventoryItemServiceImplTestHelper <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="fu">InventoryItemServiceImplTestHelper</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Utility class - no instances</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">void</span> <span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="bu">String</span> username<span class="op">,</span> <span class="bu">String</span><span class="kw">...</span> roles<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Authentication setup logic</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2
        id="inventoryitemserviceimpltesthelper">InventoryItemServiceImplTestHelper</h2>
        <p><strong>Location:</strong>
        <code>src/test/java/com/smartsupplypro/inventory/service/impl/InventoryItemServiceImplTestHelper.java</code></p>
        <p><strong>Purpose:</strong> Centralizes OAuth2 authentication
        setup for <code>InventoryItemServiceImpl</code> test classes,
        eliminating duplication across multiple test files.</p>
        <p><strong>Why It Exists:</strong> -
        <code>InventoryItemServiceImpl</code> requires authenticated
        users (OAuth2) for most operations - Multiple test classes
        (<code>SaveTest</code>, <code>UpdateDeleteTest</code>,
        <code>SearchTest</code>) need the same authentication setup -
        Without this helper, each test class would duplicate
        authentication code - Provides a single point of change if
        authentication patterns need updates</p>
        <h3 id="method-1-authenticateasoauth2username-roles...">Method
        1: <code>authenticateAsOAuth2(username, roles...)</code></h3>
        <p><strong>Recommended approach.</strong> Mimics actual Spring
        OAuth2 authentication flow.</p>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> <span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="bu">String</span> username<span class="op">,</span> <span class="bu">String</span><span class="kw">...</span> roles<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create role authorities with ROLE_ prefix (e.g., &quot;ADMIN&quot; -&gt; &quot;ROLE_ADMIN&quot;)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>SimpleGrantedAuthority<span class="op">&gt;</span> roleAuthorities <span class="op">=</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Arrays</span><span class="op">.</span><span class="fu">stream</span><span class="op">(</span>roles<span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">map</span><span class="op">(</span>r <span class="op">-&gt;</span> <span class="kw">new</span> <span class="fu">SimpleGrantedAuthority</span><span class="op">(</span><span class="st">&quot;ROLE_&quot;</span> <span class="op">+</span> r<span class="op">))</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">toList</span><span class="op">();</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create bare authorities without prefix (some code paths check both forms)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>SimpleGrantedAuthority<span class="op">&gt;</span> bareAuthorities <span class="op">=</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Arrays</span><span class="op">.</span><span class="fu">stream</span><span class="op">(</span>roles<span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">map</span><span class="op">(</span>SimpleGrantedAuthority<span class="op">::</span><span class="kw">new</span><span class="op">)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">toList</span><span class="op">();</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Combine both authority lists to cover all code paths</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>GrantedAuthority<span class="op">&gt;</span> authorities <span class="op">=</span> <span class="kw">new</span> java<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">ArrayList</span><span class="op">&lt;&gt;(</span>roleAuthorities<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">+</span> bareAuthorities<span class="op">.</span><span class="fu">size</span><span class="op">());</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    authorities<span class="op">.</span><span class="fu">addAll</span><span class="op">(</span>roleAuthorities<span class="op">);</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    authorities<span class="op">.</span><span class="fu">addAll</span><span class="op">(</span>bareAuthorities<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create OAuth2 attributes matching Google OAuth2 structure</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;</span> attrs <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;sub&quot;</span><span class="op">,</span> username<span class="op">,</span>                     <span class="co">// Subject: user ID</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;email&quot;</span><span class="op">,</span> username <span class="op">+</span> <span class="st">&quot;@example.com&quot;</span><span class="op">,</span> <span class="co">// Email attribute</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span><span class="op">,</span> username                    <span class="co">// User name</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create OAuth2User principal with attributes and authorities</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    OAuth2User principal <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultOAuth2User</span><span class="op">(</span>authorities<span class="op">,</span> attrs<span class="op">,</span> <span class="st">&quot;sub&quot;</span><span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create OAuth2AuthenticationToken (mimics Spring OAuth2 authentication flow)</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    OAuth2AuthenticationToken oauth2 <span class="op">=</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">OAuth2AuthenticationToken</span><span class="op">(</span>principal<span class="op">,</span> authorities<span class="op">,</span> <span class="st">&quot;test&quot;</span><span class="op">);</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set in security context so @PreAuthorize and hasRole() checks will see it</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">setAuthentication</span><span class="op">(</span>oauth2<span class="op">);</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>Parameters:</strong> - <code>username</code> -
        Username/email for the authenticated user - <code>roles</code> -
        Variable number of role names (e.g., ‚ÄúADMIN‚Äù, ‚ÄúUSER‚Äù)</p>
        <p><strong>How It Works:</strong> 1. Converts role names to
        <code>ROLE_</code> prefixed authorities (Spring Security
        convention) 2. Also creates bare authorities without prefix
        (covers both code paths) 3. Creates OAuth2 attributes matching
        Google OAuth2 structure (sub, email, name) 4. Creates
        <code>OAuth2AuthenticationToken</code> (mimics real Google
        login) 5. Sets token in <code>SecurityContextHolder</code> so
        security checks see the authenticated user</p>
        <p><strong>Usage Example:</strong></p>
        <div class="sourceCode" id="cb3"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">@DisplayName</span><span class="op">(</span><span class="st">&quot;Admin should be able to save inventory items&quot;</span><span class="op">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testSaveAsAdmin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Authenticate as admin user</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    InventoryItemServiceImplTestHelper<span class="op">.</span><span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="st">&quot;admin@example.com&quot;</span><span class="op">,</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now the service sees this user as authenticated with ADMIN role</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    InventoryItem item <span class="op">=</span> InventoryItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">id</span><span class="op">(</span><span class="st">&quot;item-1&quot;</span><span class="op">)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">name</span><span class="op">(</span><span class="st">&quot;Widget&quot;</span><span class="op">)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    InventoryItem saved <span class="op">=</span> inventoryItemService<span class="op">.</span><span class="fu">save</span><span class="op">(</span>item<span class="op">);</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertNotNull</span><span class="op">(</span>saved<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="at">@DisplayName</span><span class="op">(</span><span class="st">&quot;Regular user should not be able to delete items&quot;</span><span class="op">)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testDeleteAsUser</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Authenticate as regular user</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    InventoryItemServiceImplTestHelper<span class="op">.</span><span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="st">&quot;user@example.com&quot;</span><span class="op">,</span> <span class="st">&quot;USER&quot;</span><span class="op">);</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This should throw AccessDeniedException because USER role lacks DELETE permission</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThrows</span><span class="op">(</span>AccessDeniedException<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="op">()</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        inventoryItemService<span class="op">.</span><span class="fu">delete</span><span class="op">(</span><span class="st">&quot;item-1&quot;</span><span class="op">);</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="method-2-mockoauth2authenticationemail-roles...">Method
        2: <code>mockOAuth2Authentication(email, roles...)</code></h3>
        <p><strong>Legacy approach.</strong> Simpler but less
        realistic.</p>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> <span class="fu">mockOAuth2Authentication</span><span class="op">(</span><span class="bu">String</span> email<span class="op">,</span> <span class="bu">String</span><span class="kw">...</span> roles<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create minimal OAuth2 attributes (email only)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">Object</span><span class="op">&gt;</span> attributes <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">&quot;email&quot;</span><span class="op">,</span> email<span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create GrantedAuthority collection from role strings</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Collection</span><span class="op">&lt;</span>GrantedAuthority<span class="op">&gt;</span> authorities <span class="op">=</span> <span class="bu">Arrays</span><span class="op">.</span><span class="fu">stream</span><span class="op">(</span>roles<span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">map</span><span class="op">(</span>SimpleGrantedAuthority<span class="op">::</span><span class="kw">new</span><span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">collect</span><span class="op">(</span>Collectors<span class="op">.</span><span class="fu">toList</span><span class="op">());</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create OAuth2User with email attribute as principal name attribute</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    OAuth2User oauth2User <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultOAuth2User</span><span class="op">(</span>authorities<span class="op">,</span> attributes<span class="op">,</span> <span class="st">&quot;email&quot;</span><span class="op">);</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create TestingAuthenticationToken (simpler but less realistic)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    Authentication auth <span class="op">=</span> <span class="kw">new</span> <span class="fu">TestingAuthenticationToken</span><span class="op">(</span>oauth2User<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> authorities<span class="op">);</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create empty context and set authentication</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    SecurityContext context <span class="op">=</span> SecurityContextHolder<span class="op">.</span><span class="fu">createEmptyContext</span><span class="op">();</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">setAuthentication</span><span class="op">(</span>auth<span class="op">);</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">setContext</span><span class="op">(</span>context<span class="op">);</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>When to Use:</strong> - Basic tests that only care
        about role presence/absence - Don‚Äôt need realistic OAuth2
        attributes - Prefer simpler setup over authenticity</p>
        <p><strong>Prefer <code>authenticateAsOAuth2()</code>
        instead</strong> for most cases.</p>
        <hr />
        <h2 id="oauth2-authentication-setup">OAuth2 Authentication
        Setup</h2>
        <h3
        id="how-authenticateasoauth2-maps-to-real-authentication">How
        <code>authenticateAsOAuth2()</code> Maps to Real
        Authentication</h3>
        <p><strong>Real Google OAuth2 Flow:</strong></p>
        <pre><code>User clicks &quot;Login with Google&quot;
    ‚Üì
Google returns OAuth2 token with attributes (sub, email, name)
    ‚Üì
Spring creates OAuth2User with these attributes
    ‚Üì
Spring wraps OAuth2User in OAuth2AuthenticationToken
    ‚Üì
Token stored in SecurityContextHolder
    ‚Üì
@PreAuthorize checks see authenticated user with roles</code></pre>
        <p><strong>Test Helper Flow:</strong></p>
        <pre><code>Call: authenticateAsOAuth2(&quot;admin@example.com&quot;, &quot;ADMIN&quot;)
    ‚Üì
Helper manually creates OAuth2User with test attributes
    ‚Üì
Helper manually creates OAuth2AuthenticationToken
    ‚Üì
Helper stores token in SecurityContextHolder
    ‚Üì
@PreAuthorize checks see authenticated user (test mimics real flow)</code></pre>
        <p><strong>Key Difference:</strong> Real flow uses actual Google
        API; test flow simulates it. Result is identical from the
        application‚Äôs perspective.</p>
        <h3 id="why-both-role-formats">Why Both Role Formats?</h3>
        <div class="sourceCode" id="cb7"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ROLE_ prefixed (Spring Security standard)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>authorities<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">SimpleGrantedAuthority</span><span class="op">(</span><span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">));</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Bare (some custom code paths check this way)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>authorities<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">SimpleGrantedAuthority</span><span class="op">(</span><span class="st">&quot;ADMIN&quot;</span><span class="op">));</span></span></code></pre></div>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// @PreAuthorize and hasRole() look for ROLE_ prefix</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;hasRole(&#39;ADMIN&#39;)&quot;</span><span class="op">)</span>  <span class="co">// Checks for ROLE_ADMIN</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Some custom code checks bare role name</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>authorities<span class="op">.</span><span class="fu">stream</span><span class="op">().</span><span class="fu">anyMatch</span><span class="op">(</span>a <span class="op">-&gt;</span> a<span class="op">.</span><span class="fu">getAuthority</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ADMIN&quot;</span><span class="op">)))</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Custom logic</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>Solution:</strong> Helper includes both, so all code
        paths see the role.</p>
        <hr />
        <h2 id="test-data-builders">Test Data Builders</h2>
        <h3 id="pattern-object-builders-for-test-data">Pattern: Object
        Builders for Test Data</h3>
        <p><strong>Why:</strong> Test classes often need to create
        complex domain objects. Builders make this clear and
        maintainable.</p>
        <p><strong>Example - InventoryItem Builder:</strong></p>
        <div class="sourceCode" id="cb9"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testSaveWithCompleteData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    InventoryItem item <span class="op">=</span> InventoryItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">id</span><span class="op">(</span><span class="st">&quot;item-123&quot;</span><span class="op">)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">name</span><span class="op">(</span><span class="st">&quot;Industrial Widget&quot;</span><span class="op">)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">description</span><span class="op">(</span><span class="st">&quot;A quality widget for industrial use&quot;</span><span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">price</span><span class="op">(</span><span class="bu">BigDecimal</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span><span class="fl">99.99</span><span class="op">))</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">quantity</span><span class="op">(</span><span class="dv">500</span><span class="op">)</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">minimumQuantity</span><span class="op">(</span><span class="dv">50</span><span class="op">)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">supplier</span><span class="op">(</span>supplierA<span class="op">)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createdBy</span><span class="op">(</span><span class="st">&quot;admin@example.com&quot;</span><span class="op">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createdAt</span><span class="op">(</span>now<span class="op">)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    InventoryItem saved <span class="op">=</span> repository<span class="op">.</span><span class="fu">save</span><span class="op">(</span>item<span class="op">);</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertEquals</span><span class="op">(</span><span class="st">&quot;item-123&quot;</span><span class="op">,</span> saved<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>Benefits:</strong> - <strong>Readable:</strong> Clear
        which fields are being set - <strong>Flexible:</strong> Easy to
        create variations (minimal vs.¬†complete objects) -
        <strong>Maintainable:</strong> If entity structure changes, one
        place to update</p>
        <h3 id="creating-test-specific-builders">Creating Test-Specific
        Builders</h3>
        <p><strong>Option 1: Use Domain Entity Builder (if
        available)</strong></p>
        <p>If your domain model has a builder (Lombok
        <code>@Builder</code>), use it directly:</p>
        <div class="sourceCode" id="cb10"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// InventoryItem has @Builder from Lombok</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>InventoryItem testItem <span class="op">=</span> InventoryItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">id</span><span class="op">(</span><span class="st">&quot;test-id&quot;</span><span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">name</span><span class="op">(</span><span class="st">&quot;Test Item&quot;</span><span class="op">)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code></pre></div>
        <p><strong>Option 2: Create Test Data Factory</strong></p>
        <p>For complex initialization logic, create a test helper:</p>
        <div class="sourceCode" id="cb11"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="kw">class</span> InventoryItemTestFactory <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> InventoryItem <span class="fu">createMinimalItem</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> InventoryItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">id</span><span class="op">(</span><span class="st">&quot;item-&quot;</span> <span class="op">+</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">())</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">name</span><span class="op">(</span><span class="st">&quot;Test Item&quot;</span><span class="op">)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">price</span><span class="op">(</span><span class="bu">BigDecimal</span><span class="op">.</span><span class="fu">TEN</span><span class="op">)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">quantity</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">minimumQuantity</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> InventoryItem <span class="fu">createCompleteItem</span><span class="op">(</span><span class="bu">String</span> id<span class="op">,</span> <span class="bu">String</span> name<span class="op">,</span> <span class="bu">BigDecimal</span> price<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> InventoryItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">id</span><span class="op">(</span>id<span class="op">)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">name</span><span class="op">(</span>name<span class="op">)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">price</span><span class="op">(</span>price<span class="op">)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">quantity</span><span class="op">(</span><span class="dv">100</span><span class="op">)</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">minimumQuantity</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">supplier</span><span class="op">(</span><span class="fu">createTestSupplier</span><span class="op">())</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">createdBy</span><span class="op">(</span><span class="st">&quot;test-user&quot;</span><span class="op">)</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">createdAt</span><span class="op">(</span>Instant<span class="op">.</span><span class="fu">now</span><span class="op">())</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="test-isolation-cleanup">Test Isolation &amp;
        Cleanup</h2>
        <h3 id="automatic-cleanup-with-datajpatest">Automatic Cleanup
        with <span class="citation"
        data-cites="DataJpaTest">@DataJpaTest</span></h3>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@DataJpaTest</span>  <span class="co">// Spring automatically handles cleanup</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AppUserRepositoryTest <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> AppUserRepository repository<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testSaveAndFind</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        AppUser user <span class="op">=</span> <span class="kw">new</span> <span class="fu">AppUser</span><span class="op">(</span><span class="st">&quot;test@example.com&quot;</span><span class="op">,</span> <span class="st">&quot;Test User&quot;</span><span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        repository<span class="op">.</span><span class="fu">save</span><span class="op">(</span>user<span class="op">);</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        Optional<span class="op">&lt;</span>AppUser<span class="op">&gt;</span> found <span class="op">=</span> repository<span class="op">.</span><span class="fu">findByEmail</span><span class="op">(</span><span class="st">&quot;test@example.com&quot;</span><span class="op">);</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">assertTrue</span><span class="op">(</span>found<span class="op">.</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// After this test, Spring automatically:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Rolls back the transaction</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Clears the H2 database</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Result: Next test starts with clean database</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>How It Works:</strong> - <code>@DataJpaTest</code>
        wraps each test in a transaction - After test completes,
        transaction is rolled back - H2 database returns to state before
        test - No data leaks between tests</p>
        <h3 id="manual-cleanup-with-beforeeach">Manual Cleanup with
        <span class="citation"
        data-cites="BeforeEach">@BeforeEach</span></h3>
        <div class="sourceCode" id="cb13"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootTest</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">@ActiveProfiles</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> InventoryItemServiceTest <span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> InventoryItemRepository repository<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@BeforeEach</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">setup</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Clear database before each test</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        repository<span class="op">.</span><span class="fu">deleteAll</span><span class="op">();</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testOperation1</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Database is clean</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testOperation2</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Database is clean</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="test-order-independence">Test Order Independence</h3>
        <p><strong>Rule:</strong> Each test must be runnable in any
        order without depending on other tests.</p>
        <p><strong>Bad (dependent on test order):</strong></p>
        <div class="sourceCode" id="cb14"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testCreateUser</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    userService<span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="st">&quot;user1&quot;</span><span class="op">);</span>  <span class="co">// Assume this runs first</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testFindUser</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    Optional<span class="op">&lt;</span>User<span class="op">&gt;</span> user <span class="op">=</span> userService<span class="op">.</span><span class="fu">findById</span><span class="op">(</span><span class="st">&quot;user1&quot;</span><span class="op">);</span>  <span class="co">// Depends on testCreateUser running first!</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span><span class="op">(</span>user<span class="op">.</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>Good (independent):</strong></p>
        <div class="sourceCode" id="cb15"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testCreateAndFindUser</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    userService<span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="st">&quot;user1&quot;</span><span class="op">);</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    Optional<span class="op">&lt;</span>User<span class="op">&gt;</span> user <span class="op">=</span> userService<span class="op">.</span><span class="fu">findById</span><span class="op">(</span><span class="st">&quot;user1&quot;</span><span class="op">);</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span><span class="op">(</span>user<span class="op">.</span><span class="fu">isPresent</span><span class="op">());</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="securitycontextholder-cleanup">SecurityContextHolder
        Cleanup</h3>
        <p>When testing security, manually clean up
        <code>SecurityContextHolder</code>:</p>
        <div class="sourceCode" id="cb16"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testAdminOperation</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    InventoryItemServiceImplTestHelper<span class="op">.</span><span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">,</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">);</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... test admin-only operation</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">@AfterEach</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">tearDown</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">clearContext</span><span class="op">();</span>  <span class="co">// Clear for next test</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="best-practices">Best Practices</h2>
        <h3 id="use-helpers-for-repetitive-setup">1. Use Helpers for
        Repetitive Setup</h3>
        <p><strong>Before (duplicated in every test class):</strong></p>
        <div class="sourceCode" id="cb17"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SaveTest <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">test1</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">List</span><span class="op">&lt;</span>GrantedAuthority<span class="op">&gt;</span> auth <span class="op">=</span> <span class="bu">List</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="kw">new</span> <span class="fu">SimpleGrantedAuthority</span><span class="op">(</span><span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">));</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        OAuth2User principal <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultOAuth2User</span><span class="op">(</span>auth<span class="op">,</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                <span class="bu">Map</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">&quot;sub&quot;</span><span class="op">,</span> <span class="st">&quot;admin&quot;</span><span class="op">,</span> <span class="st">&quot;email&quot;</span><span class="op">,</span> <span class="st">&quot;admin@example.com&quot;</span><span class="op">),</span> <span class="st">&quot;sub&quot;</span><span class="op">);</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        OAuth2AuthenticationToken token <span class="op">=</span> <span class="kw">new</span> <span class="fu">OAuth2AuthenticationToken</span><span class="op">(</span>principal<span class="op">,</span> auth<span class="op">,</span> <span class="st">&quot;test&quot;</span><span class="op">);</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">setAuthentication</span><span class="op">(</span>token<span class="op">);</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... test logic</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>After (using helper):</strong></p>
        <div class="sourceCode" id="cb18"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SaveTest <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">test1</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        InventoryItemServiceImplTestHelper<span class="op">.</span><span class="fu">authenticateAsOAuth2</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">,</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">);</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... test logic</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="name-test-helpers-descriptively">2. Name Test Helpers
        Descriptively</h3>
        <p><strong>Convention:</strong>
        <code>{TestClass}TestHelper</code> or
        <code>{Domain}TestFactory</code></p>
        <div class="sourceCode" id="cb19"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Good</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>InventoryItemServiceImplTestHelper          <span class="co">// Service test helper</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>InventoryItemRepositoryTestFactory          <span class="co">// Repository test factory</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>AuthenticationTestHelper                    <span class="co">// Authentication helper</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Avoid</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>Helper</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>TestUtil</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">Util</span></span></code></pre></div>
        <h3 id="make-helpers-stateless">3. Make Helpers Stateless</h3>
        <p><strong>Bad:</strong></p>
        <div class="sourceCode" id="cb20"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestHelper <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> currentUser<span class="op">;</span>  <span class="co">// State!</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">setUser</span><span class="op">(</span><span class="bu">String</span> user<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">currentUser</span> <span class="op">=</span> user<span class="op">;</span>  <span class="co">// Side effect</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <p><strong>Good:</strong></p>
        <div class="sourceCode" id="cb21"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestHelper <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">void</span> <span class="fu">authenticateAsUser</span><span class="op">(</span><span class="bu">String</span> user<span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// No state, just does setup</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="document-why-helpers-exist">4. Document Why Helpers
        Exist</h3>
        <div class="sourceCode" id="cb22"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Shared helper methods for InventoryItemServiceImpl test classes<span class="co">.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Purpose<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Provides OAuth2 authentication setup for test security context<span class="co">.</span><span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Simplifies mocking of authenticated user scenarios across multiple test classes<span class="co">.</span><span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Key Methods<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="co">...</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span></code></pre></div>
        <h3 id="keep-builders-simple">5. Keep Builders Simple</h3>
        <p><strong>Too complex:</strong></p>
        <div class="sourceCode" id="cb23"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Trying to handle every possible combination</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>InventoryItem item <span class="op">=</span> InventoryItemTestFactory<span class="op">.</span><span class="fu">create</span><span class="op">()</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">withId</span><span class="op">(</span><span class="st">&quot;id-1&quot;</span><span class="op">)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">withName</span><span class="op">(</span><span class="st">&quot;Name&quot;</span><span class="op">)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">withPrice</span><span class="op">(</span><span class="dv">100</span><span class="op">)</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">withQuantity</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... 20 more options</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code></pre></div>
        <p><strong>Better (multiple simple methods):</strong></p>
        <div class="sourceCode" id="cb24"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Minimal item</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>InventoryItem item <span class="op">=</span> InventoryItemTestFactory<span class="op">.</span><span class="fu">createMinimal</span><span class="op">();</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Complete item with specific values</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>InventoryItem item <span class="op">=</span> InventoryItemTestFactory<span class="op">.</span><span class="fu">createComplete</span><span class="op">(</span><span class="st">&quot;id-1&quot;</span><span class="op">,</span> <span class="st">&quot;Name&quot;</span><span class="op">,</span> <span class="dv">100</span><span class="op">);</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">// In test, modify as needed</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span><span class="dv">50</span><span class="op">);</span></span></code></pre></div>
        <hr />
        <h2 id="summary">Summary</h2>
        <table>
        <colgroup>
        <col style="width: 32%" />
        <col style="width: 35%" />
        <col style="width: 32%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Pattern</th>
        <th>Use Case</th>
        <th>Example</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><strong>Test Helper</strong></td>
        <td>Repetitive setup logic (auth, mocking)</td>
        <td><code>InventoryItemServiceImplTestHelper</code></td>
        </tr>
        <tr class="even">
        <td><strong>Test Factory</strong></td>
        <td>Creating complex test data</td>
        <td><code>InventoryItemTestFactory.createComplete()</code></td>
        </tr>
        <tr class="odd">
        <td><strong>Builder Pattern</strong></td>
        <td>Clear, flexible object construction</td>
        <td><code>InventoryItem.builder()...build()</code></td>
        </tr>
        <tr class="even">
        <td><strong><span class="citation"
        data-cites="BeforeEach">@BeforeEach</span></strong></td>
        <td>Manual cleanup, per-test setup</td>
        <td><code>repository.deleteAll()</code></td>
        </tr>
        <tr class="odd">
        <td><strong><span class="citation"
        data-cites="DataJpaTest">@DataJpaTest</span></strong></td>
        <td>Automatic transaction rollback</td>
        <td>Test isolation without manual cleanup</td>
        </tr>
        <tr class="even">
        <td><strong>SecurityContextHolder.clearContext()</strong></td>
        <td>Security test cleanup</td>
        <td>After each security-related test</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <h2 id="see-also">See Also</h2>
        <ul>
        <li><a href="./index.html">Testing Index</a> - Master testing
        documentation</li>
        <li><a href="./unit-testing.html">Unit Testing</a> - JUnit 5 and
        Mockito patterns</li>
        <li><a href="./integration-testing.html">Integration Testing</a>
        - <span class="citation"
        data-cites="DataJpaTest">@DataJpaTest</span> and <span
        class="citation" data-cites="WebMvcTest">@WebMvcTest</span></li>
        <li><a href="./security-testing.html">Security Testing</a> -
        OAuth2 and RBAC testing</li>
        </ul>
      </article>
    </section>
  </main>

  <footer class="footer">
    Smart Supply Pro ¬∑ Generated by Docs Pipeline
  </footer>

  <!-- Mermaid for diagrams in ```mermaid``` blocks -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>
</body>
</html>
