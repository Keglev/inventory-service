<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Backend ¬∑
security/field-level-validation ¬∑ Smart Supply Pro Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS lives under /templates on GitHub Pages for inventory-service repo -->
  <link rel="stylesheet" href="/inventory-service/templates/docs.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/inventory-service/" class="logo">üì¶ Smart Supply Pro Docs</a>
      <nav class="nav">
      <a href="/inventory-service/architecture/index.html">Backend Architecture</a>
      <a href="/inventory-service/architecture/overview-de.html">Backend Architektur Deutsch</a>
      <a href="/inventory-service/frontend/architecture/index.html">Frontend Architecture</a>
      <a href="/inventory-service/backend/api/index.html">Backend API</a>
      <a href="/inventory-service/frontend/api/index.html">Frontend API</a>
      <a href="/inventory-service/backend/coverage/index.html">Backend Coverage</a>  
      <a href="/inventory-service/frontend/coverage/index.html">Frontend Coverage</a>
      </nav>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Backend</h2>
      <ul>
        <li><a href="/inventory-service/architecture/overview.html">Architecture Overview</a></li>
        <li><a href="/inventory-service/architecture/overview-de.html">Architektur-√úberblick</a></li>
        <li><a href="/inventory-service/architecture/layers/overview.html">Layers</a></li>
        <li><a href="/inventory-service/architecture/model/index.html">Data Models</a></li>
        <li><a href="/inventory-service/architecture/enums/index.html">Enums</a></li>
        <li><a href="/inventory-service/architecture/dto/index.html">DTOs</a></li>
        <li><a href="/inventory-service/architecture/config/index.html">Config</a></li>
        <li><a href="/inventory-service/architecture/controller/index.html">Controllers</a></li>
        <li><a href="/inventory-service/architecture/security/index.html">Security</a></li>
        <li><a href="/inventory-service/architecture/deployment/index.html">Deployment</a></li>
        <li><a href="/inventory-service/architecture/exception/index.html">Exception Handling</a></li>
        <li><a href="/inventory-service/architecture/integration/index.html">Integration</a></li>
        <li><a href="/inventory-service/architecture/repository/index.html">Repository</a></li>
        <li><a href="/inventory-service/architecture/resources/index.html">Resources</a></li>
        <li><a href="/inventory-service/architecture/validation/index.html">Validation</a></li>
        <li><a href="/inventory-service/architecture/testing/index.html">Testing</a></li>
        <li><a href="/inventory-service/architecture/diagrams/index.html">Diagrams</a></li>
      </ul>

      <h2>Frontend</h2>
      <ul>
        <h3>Docs coming soon</h3>
        <!-- Future <li><a href="/inventory-service/frontend/architecture/overview.html">Architecture Overview</a></li> -->
      </ul>

      <h2>Quality</h2>
      <ul>
        <li><a href="/inventory-service/backend/api/index.html">API Reference</a></li>
        <li><a href="/inventory-service/backend/coverage/index.html">JaCoCo Coverage</a></li>
      </ul>
    </aside>

    <section class="content">
            <nav class="toc">
        <h2>On this page</h2>
        <ul>
        <li><a href="#field-level-security-validation"
        id="toc-field-level-security-validation">Field-Level Security
        Validation</a>
        <ul>
        <li><a href="#overview" id="toc-overview">Overview</a></li>
        <li><a href="#field-level-authorization-model"
        id="toc-field-level-authorization-model">Field-Level
        Authorization Model</a>
        <ul>
        <li><a href="#role-based-field-restrictions"
        id="toc-role-based-field-restrictions">Role-Based Field
        Restrictions</a></li>
        <li><a href="#access-control-matrix"
        id="toc-access-control-matrix">Access Control Matrix</a></li>
        </ul></li>
        <li><a href="#inventoryitemsecurityvalidator"
        id="toc-inventoryitemsecurityvalidator">InventoryItemSecurityValidator</a>
        <ul>
        <li><a href="#location-and-purpose"
        id="toc-location-and-purpose">Location and Purpose</a></li>
        <li><a href="#implementation"
        id="toc-implementation">Implementation</a></li>
        <li><a href="#key-design-decisions"
        id="toc-key-design-decisions">Key Design Decisions</a></li>
        </ul></li>
        <li><a href="#service-layer-integration"
        id="toc-service-layer-integration">Service Layer Integration</a>
        <ul>
        <li><a href="#inventoryitemservice-usage"
        id="toc-inventoryitemservice-usage">InventoryItemService
        Usage</a></li>
        <li><a href="#call-stack" id="toc-call-stack">Call
        Stack</a></li>
        </ul></li>
        <li><a href="#authorization-flow-diagram"
        id="toc-authorization-flow-diagram">Authorization Flow
        Diagram</a></li>
        <li><a href="#error-scenarios" id="toc-error-scenarios">Error
        Scenarios</a>
        <ul>
        <li><a href="#scenario-1-user-attempts-to-change-item-name"
        id="toc-scenario-1-user-attempts-to-change-item-name">Scenario
        1: USER Attempts to Change Item Name</a></li>
        <li><a href="#scenario-2-user-updates-only-quantity-allowed"
        id="toc-scenario-2-user-updates-only-quantity-allowed">Scenario
        2: USER Updates Only Quantity (Allowed)</a></li>
        <li><a href="#scenario-3-admin-updates-all-fields"
        id="toc-scenario-3-admin-updates-all-fields">Scenario 3: ADMIN
        Updates All Fields</a></li>
        </ul></li>
        <li><a href="#security-considerations"
        id="toc-security-considerations">Security Considerations</a>
        <ul>
        <li><a href="#defense-in-depth" id="toc-defense-in-depth">1.
        Defense in Depth</a></li>
        <li><a href="#role-based-vs-attribute-based"
        id="toc-role-based-vs-attribute-based">2. Role-Based vs
        Attribute-Based</a></li>
        <li><a href="#fail-safe-defaults" id="toc-fail-safe-defaults">3.
        Fail-Safe Defaults</a></li>
        <li><a href="#immutable-field-protection"
        id="toc-immutable-field-protection">4. Immutable Field
        Protection</a></li>
        </ul></li>
        <li><a href="#testing-patterns"
        id="toc-testing-patterns">Testing Patterns</a>
        <ul>
        <li><a href="#unit-test-example" id="toc-unit-test-example">Unit
        Test Example</a></li>
        <li><a href="#integration-test-example"
        id="toc-integration-test-example">Integration Test
        Example</a></li>
        </ul></li>
        <li><a href="#comparison-with-method-level-security"
        id="toc-comparison-with-method-level-security">Comparison with
        Method-Level Security</a></li>
        <li><a href="#related-documentation"
        id="toc-related-documentation">Related Documentation</a></li>
        </ul></li>
        </ul>
      </nav>
      
      <article class="doc-body">
        <p><a href="./index.html">‚¨ÖÔ∏è Back to Security Index</a></p>
        <h1 id="field-level-security-validation">Field-Level Security
        Validation</h1>
        <h2 id="overview">Overview</h2>
        <p>Smart Supply Pro implements <strong>field-level security
        validation</strong> to restrict which user roles can modify
        specific inventory item fields. This layer complements
        method-level security (<span class="citation"
        data-cites="PreAuthorize">@PreAuthorize</span>) by enforcing
        fine-grained authorization before the service layer commits
        database changes.</p>
        <hr />
        <h2 id="field-level-authorization-model">Field-Level
        Authorization Model</h2>
        <h3 id="role-based-field-restrictions">Role-Based Field
        Restrictions</h3>
        <p><strong>USER Role</strong> (Read-only contributors): - ‚úÖ Can
        modify: <code>quantity</code>, <code>price</code> - ‚ùå Cannot
        modify: <code>name</code>, <code>supplierId</code>, other fields
        - Use case: Inventory coordinators updating stock levels and
        pricing</p>
        <p><strong>ADMIN Role</strong> (Full control): - ‚úÖ Can modify:
        All fields - Use case: System administrators, business
        managers</p>
        <h3 id="access-control-matrix">Access Control Matrix</h3>
        <table>
        <thead>
        <tr class="header">
        <th>Field</th>
        <th>USER</th>
        <th>ADMIN</th>
        <th>GET Access</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code>id</code></td>
        <td>‚ùå</td>
        <td>‚ùå</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="even">
        <td><code>name</code></td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="odd">
        <td><code>supplierId</code></td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="even">
        <td><code>quantity</code></td>
        <td>‚úÖ</td>
        <td>‚úÖ</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="odd">
        <td><code>price</code></td>
        <td>‚úÖ</td>
        <td>‚úÖ</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="even">
        <td><code>description</code></td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="odd">
        <td><code>createdAt</code></td>
        <td>‚ùå</td>
        <td>‚ùå</td>
        <td>‚úÖ (Read)</td>
        </tr>
        <tr class="even">
        <td><code>updatedAt</code></td>
        <td>‚ùå</td>
        <td>‚ùå</td>
        <td>‚úÖ (Read)</td>
        </tr>
        </tbody>
        </table>
        <hr />
        <h2
        id="inventoryitemsecurityvalidator">InventoryItemSecurityValidator</h2>
        <h3 id="location-and-purpose">Location and Purpose</h3>
        <p><strong>File:</strong>
        <code>src/main/java/com/smartsupplypro/inventory/validation/InventoryItemSecurityValidator.java</code></p>
        <p><strong>Purpose:</strong> - Validates user permissions before
        inventory item field modifications - Throws HTTP 403 if
        unauthorized field change attempted - Integrates with service
        layer for pre-commit validation</p>
        <h3 id="implementation">Implementation</h3>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Security validator for role<span class="co">-</span>based inventory item update restrictions<span class="co">.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Access Control<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;</span><span class="co">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>ADMIN<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;</span><span class="co">:</span> Full update permissions <span class="co">(</span>name<span class="co">,</span> supplier<span class="co">,</span> quantity<span class="co">,</span> price<span class="co">)</span><span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span>   <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>USER<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;</span><span class="co">:</span> Restricted to quantity and price updates only<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Design<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;</span><span class="co">:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Validates field<span class="co">-</span>level permissions before service layer commits changes<span class="co">.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Throws HTTP <span class="co">403</span> for unauthorized field modifications<span class="co">.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="co">@</span>see InventoryItemService</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> InventoryItemSecurityValidator <span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Validates user has permission to update specific inventory item fields<span class="co">.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> USER role<span class="co">:</span> only quantity and price changes allowed<span class="co">.</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> ADMIN role<span class="co">:</span> full update permissions<span class="co">.</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>param existing current inventory item entity</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>param incoming updated item DTO from request</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>throws ResponseStatusException <span class="co">401</span> if not authenticated<span class="co">,</span> <span class="co">403</span> if unauthorized field change</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">validateUpdatePermissions</span><span class="op">(</span>InventoryItem existing<span class="op">,</span> InventoryItemDTO incoming<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get current authenticated user</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        Authentication auth <span class="op">=</span> SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">getAuthentication</span><span class="op">();</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>auth <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="op">!(</span>auth<span class="op">.</span><span class="fu">getPrincipal</span><span class="op">()</span> <span class="kw">instanceof</span> OAuth2User<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ResponseStatusException</span><span class="op">(</span>HttpStatus<span class="op">.</span><span class="fu">UNAUTHORIZED</span><span class="op">,</span> <span class="st">&quot;Unauthorized access&quot;</span><span class="op">);</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Extract user role from OAuth2 authorities</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        OAuth2User user <span class="op">=</span> <span class="op">(</span>OAuth2User<span class="op">)</span> auth<span class="op">.</span><span class="fu">getPrincipal</span><span class="op">();</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> role <span class="op">=</span> user<span class="op">.</span><span class="fu">getAuthorities</span><span class="op">().</span><span class="fu">stream</span><span class="op">()</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">map</span><span class="op">(</span>a <span class="op">-&gt;</span> a<span class="op">.</span><span class="fu">getAuthority</span><span class="op">())</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">filter</span><span class="op">(</span>r <span class="op">-&gt;</span> r<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">)</span> <span class="op">||</span> r<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">))</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">findFirst</span><span class="op">()</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">orElse</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">);</span> <span class="co">// Default to USER if not explicitly found</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Enforce field-level restrictions for USER role</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>role<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">boolean</span> nameChanged <span class="op">=</span> <span class="op">!</span>existing<span class="op">.</span><span class="fu">getName</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span>incoming<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">boolean</span> supplierChanged <span class="op">=</span> <span class="op">!</span>existing<span class="op">.</span><span class="fu">getSupplierId</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span>incoming<span class="op">.</span><span class="fu">getSupplierId</span><span class="op">());</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>nameChanged <span class="op">||</span> supplierChanged<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ResponseStatusException</span><span class="op">(</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                    HttpStatus<span class="op">.</span><span class="fu">FORBIDDEN</span><span class="op">,</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Users are only allowed to change quantity or price.&quot;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">);</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ADMIN role: no field-level restrictions (method-level @PreAuthorize already verified)</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="key-design-decisions">Key Design Decisions</h3>
        <p><strong>1. Static Method Pattern</strong></p>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">validateUpdatePermissions</span><span class="op">(</span>InventoryItem existing<span class="op">,</span> InventoryItemDTO incoming<span class="op">)</span></span></code></pre></div>
        <ul>
        <li>Utility method (no instance state)</li>
        <li>Easy to call from service layer</li>
        <li>Composable with other validators</li>
        </ul>
        <p><strong>2. Fail-Secure Approach</strong></p>
        <div class="sourceCode" id="cb3"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> role <span class="op">=</span> <span class="kw">...</span> <span class="op">.</span><span class="fu">orElse</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">);</span>  <span class="co">// Default to most-restrictive role</span></span></code></pre></div>
        <ul>
        <li>Defaults to USER if role cannot be determined</li>
        <li>Prevents accidental privilege escalation</li>
        </ul>
        <p><strong>3. Explicit Field Comparison</strong></p>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> nameChanged <span class="op">=</span> <span class="op">!</span>existing<span class="op">.</span><span class="fu">getName</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span>incoming<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span></code></pre></div>
        <ul>
        <li>Only raises exception if field actually changed</li>
        <li>Allows re-submission of same data</li>
        <li>Clear intent in error message</li>
        </ul>
        <hr />
        <h2 id="service-layer-integration">Service Layer
        Integration</h2>
        <h3 id="inventoryitemservice-usage">InventoryItemService
        Usage</h3>
        <div class="sourceCode" id="cb5"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Service</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> InventoryItemService <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Updates inventory item with field<span class="co">-</span>level security validation<span class="co">.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> InventoryItemDTO <span class="fu">updateInventoryItem</span><span class="op">(</span><span class="bu">Long</span> id<span class="op">,</span> InventoryItemDTO updateDto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 1. Retrieve existing item</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        InventoryItem existing <span class="op">=</span> inventoryItemRepository</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">findById</span><span class="op">(</span>id<span class="op">)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">orElseThrow</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="kw">new</span> <span class="fu">ResourceNotFoundException</span><span class="op">(</span><span class="st">&quot;Item not found&quot;</span><span class="op">));</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 2. Validate field-level permissions (throws 403 if unauthorized)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        InventoryItemSecurityValidator<span class="op">.</span><span class="fu">validateUpdatePermissions</span><span class="op">(</span>existing<span class="op">,</span> updateDto<span class="op">);</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 3. Update allowed fields</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        existing<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span>updateDto<span class="op">.</span><span class="fu">getQuantity</span><span class="op">());</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        existing<span class="op">.</span><span class="fu">setPrice</span><span class="op">(</span>updateDto<span class="op">.</span><span class="fu">getPrice</span><span class="op">());</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 4. If ADMIN, allow additional fields</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="fu">isAdmin</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>            existing<span class="op">.</span><span class="fu">setName</span><span class="op">(</span>updateDto<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            existing<span class="op">.</span><span class="fu">setSupplierId</span><span class="op">(</span>updateDto<span class="op">.</span><span class="fu">getSupplierId</span><span class="op">());</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 5. Persist changes</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        InventoryItem saved <span class="op">=</span> inventoryItemRepository<span class="op">.</span><span class="fu">save</span><span class="op">(</span>existing<span class="op">);</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mapper<span class="op">.</span><span class="fu">toDto</span><span class="op">(</span>saved<span class="op">);</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">boolean</span> <span class="fu">isAdmin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        Authentication auth <span class="op">=</span> SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">getAuthentication</span><span class="op">();</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> auth<span class="op">.</span><span class="fu">getAuthorities</span><span class="op">().</span><span class="fu">stream</span><span class="op">()</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">anyMatch</span><span class="op">(</span>a <span class="op">-&gt;</span> a<span class="op">.</span><span class="fu">getAuthority</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">));</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="call-stack">Call Stack</h3>
        <pre><code>Controller.updateInventoryItem(@PathVariable id, @RequestBody updateDto)
    ‚Üì
SecurityConfig.authorizeHttpRequests()
    ‚îú‚îÄ @PreAuthorize(&quot;hasRole(&#39;ADMIN&#39;)&quot;) at method level
    ‚îî‚îÄ Checks: User authenticated AND has ADMIN role
    ‚Üì
Service.updateInventoryItem(id, updateDto)
    ‚îú‚îÄ InventoryItemSecurityValidator.validateUpdatePermissions()
    ‚îÇ   ‚îî‚îÄ Checks: If USER role, only quantity/price allowed
    ‚îÇ   ‚îî‚îÄ Throws 403 if field restriction violated
    ‚îú‚îÄ Update allowed fields
    ‚îî‚îÄ Return DTO</code></pre>
        <hr />
        <h2 id="authorization-flow-diagram">Authorization Flow
        Diagram</h2>
        <div class="mermaid">
        graph TD
            A["PUT /api/inventory/{id}"] -->|Request| B["Controller"]
            B -->|1. Method-Level Check| C{"@PreAuthorize hasRole?"}
            C -->|No| D["403 Forbidden<br/>Insufficient Role"]
            C -->|Yes| E["Service.updateInventoryItem()"]
            E -->|2. Field-Level Check| F["InventoryItemSecurityValidator"]
            F -->|Extract Role| G{"User is ADMIN?"}
            G -->|Yes| H["Allow all fields"]
            G -->|No| I{"nameChanged or<br/>supplierIdChanged?"}
            I -->|Yes| J["403 Forbidden<br/>Restricted Fields"]
            I -->|No| K["Proceed to Update"]
            H --> K
            K -->|3. Persist| L["Repository.save()"]
            L -->|Success| M["200 OK + DTO"]
        </div>
        <hr />
        <h2 id="error-scenarios">Error Scenarios</h2>
        <h3 id="scenario-1-user-attempts-to-change-item-name">Scenario
        1: USER Attempts to Change Item Name</h3>
        <p><strong>Request:</strong></p>
        <div class="sourceCode" id="cb7"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/api/inventory/42</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;New Item Name&quot;</span><span class="fu">,</span>      <span class="er">//</span> <span class="er">‚ùå</span> <span class="er">Restricted</span> <span class="er">field</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">15.99</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <p><strong>Response:</strong></p>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="er">HTTP/1.1</span> <span class="er">403</span> <span class="er">Forbidden</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-01-15T10:30:00Z&quot;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="dv">403</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Forbidden&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Users are only allowed to change quantity or price.&quot;</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;/api/inventory/42&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <h3 id="scenario-2-user-updates-only-quantity-allowed">Scenario
        2: USER Updates Only Quantity (Allowed)</h3>
        <p><strong>Request:</strong></p>
        <div class="sourceCode" id="cb9"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/api/inventory/42</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Current Name&quot;</span><span class="fu">,</span>       <span class="er">//</span> <span class="er">‚úÖ</span> <span class="er">Not</span> <span class="er">changed</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span>              <span class="er">//</span> <span class="er">‚úÖ</span> <span class="er">Allowed</span> <span class="er">field</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">15.99</span>                <span class="er">//</span> <span class="er">‚úÖ</span> <span class="er">Allowed</span> <span class="er">field</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <p><strong>Response:</strong></p>
        <div class="sourceCode" id="cb10"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="er">HTTP/1.1</span> <span class="er">200</span> <span class="er">OK</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">42</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Current Name&quot;</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">15.99</span><span class="fu">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;supplierId&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2023-12-01T08:00:00Z&quot;</span><span class="fu">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-01-15T10:30:00Z&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <h3 id="scenario-3-admin-updates-all-fields">Scenario 3: ADMIN
        Updates All Fields</h3>
        <p><strong>Request:</strong></p>
        <div class="sourceCode" id="cb11"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/api/inventory/42</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Renamed Item&quot;</span><span class="fu">,</span>       <span class="er">//</span> <span class="er">‚úÖ</span> <span class="er">ADMIN</span> <span class="er">allowed</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;supplierId&quot;</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span>              <span class="er">//</span> <span class="er">‚úÖ</span> <span class="er">ADMIN</span> <span class="er">allowed</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">25.99</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <p><strong>Response:</strong></p>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="er">HTTP/1.1</span> <span class="er">200</span> <span class="er">OK</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">42</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Renamed Item&quot;</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;supplierId&quot;</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">25.99</span><span class="fu">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2023-12-01T08:00:00Z&quot;</span><span class="fu">,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-01-15T10:30:00Z&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <hr />
        <h2 id="security-considerations">Security Considerations</h2>
        <h3 id="defense-in-depth">1. Defense in Depth</h3>
        <p><strong>Layers of Authorization:</strong></p>
        <ol type="1">
        <li><strong>Entry Point</strong> - Authentication (OAuth2)
        <ul>
        <li>Verify user identity</li>
        </ul></li>
        <li><strong>Method Level</strong> - <span class="citation"
        data-cites="PreAuthorize">@PreAuthorize</span> with role check
        <ul>
        <li>Enforce ADMIN role requirement</li>
        </ul></li>
        <li><strong>Field Level</strong> -
        InventoryItemSecurityValidator
        <ul>
        <li>Restrict field modifications by role</li>
        </ul></li>
        <li><strong>Database Level</strong> - Oracle row-level security
        (optional)
        <ul>
        <li>Restrict data access at database layer</li>
        </ul></li>
        </ol>
        <p><strong>Benefit:</strong> Multiple layers prevent privilege
        escalation</p>
        <h3 id="role-based-vs-attribute-based">2. Role-Based vs
        Attribute-Based</h3>
        <p><strong>Current Approach (Role-Based):</strong></p>
        <div class="sourceCode" id="cb13"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>role<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Restrict fields</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <ul>
        <li>Simple, fast, easy to understand</li>
        <li>Suitable for 2-3 role systems</li>
        </ul>
        <p><strong>Future Extension (Attribute-Based):</strong></p>
        <div class="sourceCode" id="cb14"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span><span class="fu">hasPermission</span><span class="op">(</span>user<span class="op">,</span> <span class="st">&quot;inventory.edit.name&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="fu">forbidden</span><span class="op">();</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <ul>
        <li>More flexible for complex permissions</li>
        <li>Requires permission matrix database</li>
        <li>Scales to many roles/permissions</li>
        </ul>
        <h3 id="fail-safe-defaults">3. Fail-Safe Defaults</h3>
        <div class="sourceCode" id="cb15"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> role <span class="op">=</span> <span class="kw">...</span> <span class="op">.</span><span class="fu">orElse</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">);</span>  <span class="co">// Most restrictive</span></span></code></pre></div>
        <ul>
        <li>Defaults to USER (least privilege)</li>
        <li>Never grants unintended access</li>
        <li>Prevents null pointer exploits</li>
        </ul>
        <h3 id="immutable-field-protection">4. Immutable Field
        Protection</h3>
        <p><strong>Fields that should never change after
        creation:</strong></p>
        <div class="sourceCode" id="cb16"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// These are handled at repository/database layer</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - id (primary key)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - createdAt (audit timestamp)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - version (optimistic locking)</span></span></code></pre></div>
        <p><strong>Why not include in validator?</strong> - Prevented by
        database schema (not nullable, immutable) - Service layer never
        attempts to update them - Validator focuses on business-logic
        field restrictions</p>
        <hr />
        <h2 id="testing-patterns">Testing Patterns</h2>
        <h3 id="unit-test-example">Unit Test Example</h3>
        <div class="sourceCode" id="cb17"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testUserCannotUpdateItemName</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Existing item and USER attempting to change name</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    InventoryItem existing <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItem</span><span class="op">();</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">1L</span><span class="op">);</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;Original Name&quot;</span><span class="op">);</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setPrice</span><span class="op">(</span><span class="fl">10.0</span><span class="op">);</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    InventoryItemDTO incoming <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItemDTO</span><span class="op">();</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;New Name&quot;</span><span class="op">);</span>        <span class="co">// Name change attempted</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setPrice</span><span class="op">(</span><span class="fl">10.0</span><span class="op">);</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mock security context with USER role</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    OAuth2User oauth2User <span class="op">=</span> <span class="fu">createOAuth2UserWithRole</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">);</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    Authentication auth <span class="op">=</span> <span class="kw">new</span> <span class="fu">OAuth2AuthenticationToken</span><span class="op">(</span>oauth2User<span class="op">,</span> oauth2User<span class="op">.</span><span class="fu">getAuthorities</span><span class="op">(),</span> <span class="st">&quot;google&quot;</span><span class="op">);</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">setAuthentication</span><span class="op">(</span>auth<span class="op">);</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When/Then: Should throw 403 Forbidden</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    ResponseStatusException ex <span class="op">=</span> <span class="fu">assertThrows</span><span class="op">(</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        ResponseStatusException<span class="op">.</span><span class="fu">class</span><span class="op">,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">()</span> <span class="op">-&gt;</span> InventoryItemSecurityValidator<span class="op">.</span><span class="fu">validateUpdatePermissions</span><span class="op">(</span>existing<span class="op">,</span> incoming<span class="op">)</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>ex<span class="op">.</span><span class="fu">getStatusCode</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>HttpStatus<span class="op">.</span><span class="fu">FORBIDDEN</span><span class="op">);</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>ex<span class="op">.</span><span class="fu">getReason</span><span class="op">()).</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;only allowed to change quantity or price&quot;</span><span class="op">);</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testAdminCanUpdateAllFields</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Existing item and ADMIN attempting to change all fields</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    InventoryItem existing <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItem</span><span class="op">();</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;Original&quot;</span><span class="op">);</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setSupplierId</span><span class="op">(</span><span class="dv">1L</span><span class="op">);</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    InventoryItemDTO incoming <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItemDTO</span><span class="op">();</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;Updated&quot;</span><span class="op">);</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setSupplierId</span><span class="op">(</span><span class="dv">2L</span><span class="op">);</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mock security context with ADMIN role</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    OAuth2User oauth2User <span class="op">=</span> <span class="fu">createOAuth2UserWithRole</span><span class="op">(</span><span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">);</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    Authentication auth <span class="op">=</span> <span class="kw">new</span> <span class="fu">OAuth2AuthenticationToken</span><span class="op">(</span>oauth2User<span class="op">,</span> oauth2User<span class="op">.</span><span class="fu">getAuthorities</span><span class="op">(),</span> <span class="st">&quot;google&quot;</span><span class="op">);</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">setAuthentication</span><span class="op">(</span>auth<span class="op">);</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When/Then: Should NOT throw exception</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertDoesNotThrow</span><span class="op">(()</span> <span class="op">-&gt;</span> </span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        InventoryItemSecurityValidator<span class="op">.</span><span class="fu">validateUpdatePermissions</span><span class="op">(</span>existing<span class="op">,</span> incoming<span class="op">)</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">testUserCanUpdateQuantityWithoutNameChange</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Existing item and USER updating quantity (same name)</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    InventoryItem existing <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItem</span><span class="op">();</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;Item A&quot;</span><span class="op">);</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    existing<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    InventoryItemDTO incoming <span class="op">=</span> <span class="kw">new</span> <span class="fu">InventoryItemDTO</span><span class="op">();</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setName</span><span class="op">(</span><span class="st">&quot;Item A&quot;</span><span class="op">);</span>        <span class="co">// Same, not changed</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    incoming<span class="op">.</span><span class="fu">setQuantity</span><span class="op">(</span><span class="dv">150</span><span class="op">);</span>         <span class="co">// Changed</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mock USER security context</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    OAuth2User oauth2User <span class="op">=</span> <span class="fu">createOAuth2UserWithRole</span><span class="op">(</span><span class="st">&quot;ROLE_USER&quot;</span><span class="op">);</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    Authentication auth <span class="op">=</span> <span class="kw">new</span> <span class="fu">OAuth2AuthenticationToken</span><span class="op">(</span>oauth2User<span class="op">,</span> oauth2User<span class="op">.</span><span class="fu">getAuthorities</span><span class="op">(),</span> <span class="st">&quot;google&quot;</span><span class="op">);</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>    SecurityContextHolder<span class="op">.</span><span class="fu">getContext</span><span class="op">().</span><span class="fu">setAuthentication</span><span class="op">(</span>auth<span class="op">);</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When/Then: Should NOT throw exception</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertDoesNotThrow</span><span class="op">(()</span> <span class="op">-&gt;</span> </span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>        InventoryItemSecurityValidator<span class="op">.</span><span class="fu">validateUpdatePermissions</span><span class="op">(</span>existing<span class="op">,</span> incoming<span class="op">)</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="integration-test-example">Integration Test Example</h3>
        <div class="sourceCode" id="cb18"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootTest</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="at">@AutoConfigureMockMvc</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> InventoryItemSecurityValidationIT <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> MockMvc mvc<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@WithMockUser</span><span class="op">(</span>roles <span class="op">=</span> <span class="st">&quot;USER&quot;</span><span class="op">)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testUserPatchRejectsNameChange</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Given: Item with id=1</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// When: USER attempts PATCH to change name</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        mvc<span class="op">.</span><span class="fu">perform</span><span class="op">(</span><span class="fu">patch</span><span class="op">(</span><span class="st">&quot;/api/inventory/1&quot;</span><span class="op">)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON</span><span class="op">)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">content</span><span class="op">(</span><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st">                {</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">                  &quot;name&quot;: &quot;Forbidden Change&quot;,</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="st">                  &quot;quantity&quot;: 100</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;&quot;&quot;</span><span class="op">))</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Then: 403 Forbidden</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">status</span><span class="op">().</span><span class="fu">isForbidden</span><span class="op">())</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">jsonPath</span><span class="op">(</span><span class="st">&quot;$.message&quot;</span><span class="op">).</span><span class="fu">value</span><span class="op">(</span><span class="fu">containsString</span><span class="op">(</span><span class="st">&quot;only allowed to change&quot;</span><span class="op">)));</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">@WithMockUser</span><span class="op">(</span>roles <span class="op">=</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testAdminPatchAllowsNameChange</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Given: Item with id=1</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// When: ADMIN attempts PATCH to change name</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        mvc<span class="op">.</span><span class="fu">perform</span><span class="op">(</span><span class="fu">patch</span><span class="op">(</span><span class="st">&quot;/api/inventory/1&quot;</span><span class="op">)</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON</span><span class="op">)</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">content</span><span class="op">(</span><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="st">                {</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="st">                  &quot;name&quot;: &quot;Allowed Change&quot;,</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="st">                  &quot;quantity&quot;: 100</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;&quot;&quot;</span><span class="op">))</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Then: 200 OK</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">status</span><span class="op">().</span><span class="fu">isOk</span><span class="op">())</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">jsonPath</span><span class="op">(</span><span class="st">&quot;$.name&quot;</span><span class="op">).</span><span class="fu">value</span><span class="op">(</span><span class="st">&quot;Allowed Change&quot;</span><span class="op">));</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="comparison-with-method-level-security">Comparison with
        Method-Level Security</h2>
        <table>
        <colgroup>
        <col style="width: 12%" />
        <col style="width: 48%" />
        <col style="width: 38%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Aspect</th>
        <th>Method-Level (<span class="citation"
        data-cites="PreAuthorize">@PreAuthorize</span>)</th>
        <th>Field-Level (Validator)</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><strong>Scope</strong></td>
        <td>Entire method/endpoint</td>
        <td>Specific fields</td>
        </tr>
        <tr class="even">
        <td><strong>Check Point</strong></td>
        <td>Before method execution</td>
        <td>Inside method logic</td>
        </tr>
        <tr class="odd">
        <td><strong>Example</strong></td>
        <td><code>@PreAuthorize("hasRole('ADMIN')")</code></td>
        <td>Restricts <code>name</code> field</td>
        </tr>
        <tr class="even">
        <td><strong>Use Case</strong></td>
        <td>Admin-only endpoints</td>
        <td>Multi-role with field restrictions</td>
        </tr>
        <tr class="odd">
        <td><strong>Error Response</strong></td>
        <td>403 Forbidden (no details)</td>
        <td>403 Forbidden (field-specific)</td>
        </tr>
        <tr class="even">
        <td><strong>Performance</strong></td>
        <td>Fast (single check)</td>
        <td>Slightly slower (field comparison)</td>
        </tr>
        </tbody>
        </table>
        <p><strong>When to use each:</strong></p>
        <div class="sourceCode" id="cb19"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method-level: Block entire endpoint</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">@DeleteMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;hasRole(&#39;ADMIN&#39;)&quot;</span><span class="op">)</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">delete</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">Long</span> id<span class="op">)</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Field-level: Allow endpoint but restrict field changes</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">@PutMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;authenticated()&quot;</span><span class="op">)</span>  <span class="co">// All authenticated users</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">update</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">Long</span> id<span class="op">,</span> <span class="at">@RequestBody</span> InventoryItemDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    InventoryItemSecurityValidator<span class="op">.</span><span class="fu">validateUpdatePermissions</span><span class="op">(</span>existing<span class="op">,</span> dto<span class="op">);</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... proceed with update</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <h2 id="related-documentation">Related Documentation</h2>
        <ul>
        <li><strong><a href="./index.html">Security Index</a></strong> -
        Master security overview</li>
        <li><strong><a href="./authorization-rbac.html">Authorization
        &amp; RBAC</a></strong> - Role-based access control
        architecture</li>
        <li><strong><a href="./oauth2-authentication.html">OAuth2
        Authentication</a></strong> - User authentication flows</li>
        </ul>
        <hr />
        <p><a href="./index.html">‚¨ÖÔ∏è Back to Security Index</a></p>
      </article>
    </section>
  </main>

  <footer class="footer">
    Smart Supply Pro ¬∑ Generated by Docs Pipeline
  </footer>

  <!-- Mermaid for diagrams in ```mermaid``` blocks -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>
</body>
</html>
