<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Backend ¬∑
layers/controller-layer ¬∑ Smart Supply Pro Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS lives under /templates on GitHub Pages for inventory-service repo -->
  <link rel="stylesheet" href="/inventory-service/templates/docs.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/inventory-service/" class="logo">üì¶ Smart Supply Pro Docs</a>
      <nav class="nav">
      <a href="/inventory-service/architecture/index.html">Backend Architecture</a>
        <!-- Future: <a href="/inventory-service/frontend/architecture/overview.html">Frontend</a> -->
        <a href="/inventory-service/backend/api/index.html">Backend API</a>
        <!-- Future: <a href="/inventory-service/frontend/api/index.html">Frontend API</a> -->
        <a href="/inventory-service/backend/coverage/index.html">Backend Coverage</a>
        <!-- Future: <a href="/inventory-service/frontend/coverage/index.html">Frontend Coverage</a> -->
      </nav>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Backend</h2>
      <ul>
        <li><a href="/inventory-service/architecture/overview.html">Architecture Overview</a></li>
        <li><a href="/inventory-service/architecture/overview-de.html">Architektur-√úberblick</a></li>
        <li><a href="/inventory-service/architecture/layers/overview.html">Layers</a></li>
        <li><a href="/inventory-service/architecture/security.html">Security</a></li>
        <li><a href="/inventory-service/architecture/deployment.html">Deployment</a></li>
      </ul>

      <h2>Frontend</h2>
      <ul>
        <h3>Docs coming soon</h3>
        <!-- Future <li><a href="/inventory-service/frontend/architecture/overview.html">Architecture Overview</a></li> -->
      </ul>

      <h2>Quality</h2>
      <ul>
        <li><a href="/inventory-service/backend/api/index.html">API Reference</a></li>
        <li><a href="/inventory-service/backend/coverage/index.html">JaCoCo Coverage</a></li>
      </ul>
    </aside>

    <section class="content">
            <nav class="toc">
        <h2>On this page</h2>
        <ul>
        <li><a href="#controller-layer"
        id="toc-controller-layer">Controller Layer</a>
        <ul>
        <li><a href="#overview" id="toc-overview">Overview</a></li>
        <li><a href="#architecture"
        id="toc-architecture">Architecture</a></li>
        <li><a href="#key-responsibilities"
        id="toc-key-responsibilities">Key Responsibilities</a>
        <ul>
        <li><a href="#request-routing" id="toc-request-routing">1.
        <strong>Request Routing</strong></a></li>
        <li><a href="#request-validation" id="toc-request-validation">2.
        <strong>Request Validation</strong></a></li>
        <li><a href="#authentication-authorization"
        id="toc-authentication-authorization">3. <strong>Authentication
        &amp; Authorization</strong></a></li>
        <li><a href="#dto-conversion-inbound"
        id="toc-dto-conversion-inbound">4. <strong>DTO Conversion
        (Inbound)</strong></a></li>
        <li><a href="#dto-conversion-outbound"
        id="toc-dto-conversion-outbound">5. <strong>DTO Conversion
        (Outbound)</strong></a></li>
        <li><a href="#response-building" id="toc-response-building">6.
        <strong>Response Building</strong></a></li>
        </ul></li>
        <li><a href="#core-controllers" id="toc-core-controllers">Core
        Controllers</a>
        <ul>
        <li><a href="#suppliercontroller"
        id="toc-suppliercontroller">SupplierController</a></li>
        <li><a href="#inventoryitemcontroller"
        id="toc-inventoryitemcontroller">InventoryItemController</a></li>
        <li><a href="#stockhistorycontroller"
        id="toc-stockhistorycontroller">StockHistoryController</a></li>
        <li><a href="#analyticscontroller"
        id="toc-analyticscontroller">AnalyticsController</a></li>
        <li><a href="#authcontroller"
        id="toc-authcontroller">AuthController</a></li>
        </ul></li>
        <li><a href="#error-handling-flow"
        id="toc-error-handling-flow">Error Handling Flow</a></li>
        <li><a href="#best-practices" id="toc-best-practices">Best
        Practices</a>
        <ul>
        <li><a href="#lean-controllers" id="toc-lean-controllers">1.
        <strong>Lean Controllers</strong></a></li>
        <li><a href="#consistent-response-structure"
        id="toc-consistent-response-structure">2. <strong>Consistent
        Response Structure</strong></a></li>
        <li><a href="#security-first-authorization"
        id="toc-security-first-authorization">3. <strong>Security-First
        Authorization</strong></a></li>
        <li><a href="#validation-at-boundary"
        id="toc-validation-at-boundary">4. <strong>Validation at
        Boundary</strong></a></li>
        <li><a href="#proper-http-status-codes"
        id="toc-proper-http-status-codes">5. <strong>Proper HTTP Status
        Codes</strong></a></li>
        <li><a href="#uri-resource-location"
        id="toc-uri-resource-location">6. <strong>URI Resource
        Location</strong></a></li>
        </ul></li>
        <li><a href="#requestresponse-lifecycle"
        id="toc-requestresponse-lifecycle">Request/Response
        Lifecycle</a></li>
        <li><a href="#integration-with-other-layers"
        id="toc-integration-with-other-layers">Integration with Other
        Layers</a></li>
        <li><a href="#testing-controller-layer"
        id="toc-testing-controller-layer">Testing Controller
        Layer</a></li>
        </ul></li>
        </ul>
      </nav>
      
      <article class="doc-body">
        <p><a href="./overview.html">‚¨ÖÔ∏è Back to Layers Overview</a></p>
        <h1 id="controller-layer">Controller Layer</h1>
        <h2 id="overview">Overview</h2>
        <p>The <strong>Controller Layer</strong> serves as the HTTP API
        entry point for all client requests. It handles request routing,
        validation, authentication/authorization checks, and response
        formatting. Controllers act as the presentation layer interface,
        converting between HTTP requests/responses and domain-level
        operations.</p>
        <p><strong>Location:</strong>
        <code>src/main/java/com/smartsupplypro/inventory/controller/</code></p>
        <p><strong>Responsibility:</strong> HTTP protocol handling,
        request validation, response building, error mapping</p>
        <h2 id="architecture">Architecture</h2>
        <div class="mermaid">
        graph TB
            Client["Client<br/>REST Requests"]
            Routes["Request Routing<br/>@GetMapping, @PostMapping, etc."]
            Auth["Authorization<br/>@PreAuthorize"]
            Validation["Request Validation<br/>@Valid, @NotNull"]
            Mapping["DTO Conversion<br/>Request ‚Üí Internal"]
            Service["Service Layer<br/>Business Logic"]
            DTOResp["DTO Conversion<br/>Domain ‚Üí Response"]
            Response["HTTP Response<br/>JSON Serialization"]

            Client -->|HTTP| Routes
            Routes --> Auth
            Auth -->|Check Roles| Validation
            Validation -->|Validate DTO| Mapping
            Mapping -->|Convert| Service
            Service -->|Execute Business Logic| DTOResp
            DTOResp -->|Convert| Response
            Response -->|JSON| Client

            style Client fill:#e3f2fd
            style Routes fill:#bbdefb
            style Auth fill:#90caf9
            style Validation fill:#64b5f6
            style Mapping fill:#42a5f5
            style Service fill:#2196f3
            style DTOResp fill:#1976d2
            style Response fill:#1565c0
        </div>
        <h2 id="key-responsibilities">Key Responsibilities</h2>
        <h3 id="request-routing">1. <strong>Request
        Routing</strong></h3>
        <p>Maps HTTP endpoints to controller methods using Spring
        annotations: - <code>@GetMapping</code> - Retrieve resources -
        <code>@PostMapping</code> - Create resources -
        <code>@PutMapping</code> - Update resources -
        <code>@DeleteMapping</code> - Delete resources -
        <code>@RequestMapping</code> - Base path configuration</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;/api/suppliers&quot;</span><span class="op">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SupplierController <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">List</span><span class="op">&lt;</span>SupplierDTO<span class="op">&gt;&gt;</span> <span class="fu">listAll</span><span class="op">()</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@PostMapping</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="request-validation">2. <strong>Request
        Validation</strong></h3>
        <p>Spring‚Äôs validation framework ensures data integrity at the
        API boundary: - <code>@Valid</code> - Triggers validation of
        nested DTO fields - <code>@NotNull</code>,
        <code>@NotBlank</code> - Standard constraint annotations -
        Custom validators for domain-specific rules</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;hasRole(&#39;ADMIN&#39;)&quot;</span><span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @Valid ensures all DTO fields meet constraints before method execution</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">ok</span><span class="op">(</span>supplierService<span class="op">.</span><span class="fu">create</span><span class="op">(</span>dto<span class="op">));</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="authentication-authorization">3. <strong>Authentication
        &amp; Authorization</strong></h3>
        <p>Spring Security integration ensures only authorized users can
        access endpoints: - <code>@PreAuthorize</code> - Method-level
        authorization checks - <code>isAuthenticated()</code> - Verify
        user is logged in - <code>hasRole('ADMIN')</code>,
        <code>hasRole('USER')</code> - Check user roles</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb3"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;isAuthenticated() or @appProperties.demoReadonly&quot;</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">@GetMapping</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">List</span><span class="op">&lt;</span>SupplierDTO<span class="op">&gt;&gt;</span> <span class="fu">listAll</span><span class="op">()</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;hasRole(&#39;ADMIN&#39;)&quot;</span><span class="op">)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">@DeleteMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">Void</span><span class="op">&gt;</span> <span class="fu">delete</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> id<span class="op">)</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code></pre></div>
        <h3 id="dto-conversion-inbound">4. <strong>DTO Conversion
        (Inbound)</strong></h3>
        <p>Converts incoming JSON to Data Transfer Objects (DTOs): -
        HTTP request body automatically deserialized to DTO via Jackson
        - Decouples API contract from internal domain models - Enables
        versioning and forward compatibility</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto  <span class="co">// Jackson deserializes JSON ‚Üí DTO</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    SupplierDTO created <span class="op">=</span> supplierService<span class="op">.</span><span class="fu">create</span><span class="op">(</span>dto<span class="op">);</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">status</span><span class="op">(</span>HttpStatus<span class="op">.</span><span class="fu">CREATED</span><span class="op">).</span><span class="fu">body</span><span class="op">(</span>created<span class="op">);</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="dto-conversion-outbound">5. <strong>DTO Conversion
        (Outbound)</strong></h3>
        <p>Converts domain objects to DTOs for JSON response
        serialization: - Service returns domain DTOs - Jackson
        serializes DTO ‚Üí JSON - Only API-relevant fields are exposed</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb5"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">getById</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> supplierService<span class="op">.</span><span class="fu">findById</span><span class="op">(</span>id<span class="op">)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">map</span><span class="op">(</span>ResponseEntity<span class="op">::</span>ok<span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">orElseThrow</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="kw">new</span> <span class="bu">NoSuchElementException</span><span class="op">(</span><span class="st">&quot;Supplier not found&quot;</span><span class="op">));</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="response-building">6. <strong>Response
        Building</strong></h3>
        <p>Constructs proper HTTP responses with appropriate status
        codes: - <code>200 OK</code> - Successful retrieval -
        <code>201 CREATED</code> - Successful resource creation -
        <code>204 NO CONTENT</code> - Successful deletion -
        <code>400 BAD REQUEST</code> - Invalid input -
        <code>404 NOT FOUND</code> - Resource not found -
        <code>409 CONFLICT</code> - Business rule violation</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb6"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    SupplierDTO created <span class="op">=</span> supplierService<span class="op">.</span><span class="fu">create</span><span class="op">(</span>dto<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">URI</span> location <span class="op">=</span> ServletUriComponentsBuilder<span class="op">.</span><span class="fu">fromCurrentRequest</span><span class="op">()</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">buildAndExpand</span><span class="op">(</span>created<span class="op">.</span><span class="fu">getId</span><span class="op">())</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">toUri</span><span class="op">();</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">created</span><span class="op">(</span>location<span class="op">).</span><span class="fu">body</span><span class="op">(</span>created<span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h2 id="core-controllers">Core Controllers</h2>
        <h3 id="suppliercontroller">SupplierController</h3>
        <p><strong>Purpose:</strong> Manage suppliers (CRUD operations)
        - <code>GET /api/suppliers</code> - List all suppliers -
        <code>POST /api/suppliers</code> - Create supplier -
        <code>GET /api/suppliers/{id}</code> - Get supplier by ID -
        <code>PUT /api/suppliers/{id}</code> - Update supplier -
        <code>DELETE /api/suppliers/{id}</code> - Delete supplier -
        <code>GET /api/suppliers/search?name=...</code> - Search
        suppliers</p>
        <p><strong>Authorization:</strong> USER can read, ADMIN can
        modify</p>
        <h3 id="inventoryitemcontroller">InventoryItemController</h3>
        <p><strong>Purpose:</strong> Manage inventory items with stock
        tracking - <code>GET /api/inventory/items</code> - List items
        (paginated) - <code>POST /api/inventory/items</code> - Create
        item - <code>GET /api/inventory/items/{id}</code> - Get item
        details - <code>PUT /api/inventory/items/{id}</code> - Update
        item - <code>DELETE /api/inventory/items/{id}</code> - Delete
        item - <code>POST /api/inventory/items/{id}/update-stock</code>
        - Update stock quantity</p>
        <p><strong>Authorization:</strong> USER can read, ADMIN can
        modify</p>
        <h3 id="stockhistorycontroller">StockHistoryController</h3>
        <p><strong>Purpose:</strong> Query stock change audit trail -
        <code>GET /api/stock-history</code> - List all stock movements -
        <code>GET /api/stock-history?itemId=...</code> - Filter by item
        - <code>GET /api/stock-history/summary</code> - Aggregate
        statistics</p>
        <p><strong>Authorization:</strong> USER read-only (audit
        trail)</p>
        <h3 id="analyticscontroller">AnalyticsController</h3>
        <p><strong>Purpose:</strong> Provide analytics and reporting
        endpoints - <code>GET /api/analytics/dashboard</code> -
        Dashboard summary (KPIs) -
        <code>GET /api/analytics/financial-summary</code> - Financial
        metrics - <code>GET /api/analytics/inventory-trends</code> -
        Trend analysis - <code>GET /api/analytics/low-stock</code> - Low
        stock alerts</p>
        <p><strong>Authorization:</strong> USER can read analytics</p>
        <h3 id="authcontroller">AuthController</h3>
        <p><strong>Purpose:</strong> OAuth2 authentication endpoints -
        <code>POST /api/auth/callback</code> - OAuth2 callback handler -
        <code>GET /api/auth/user</code> - Current user info -
        <code>POST /api/auth/logout</code> - User logout</p>
        <p><strong>Authorization:</strong> PUBLIC for login,
        AUTHENTICATED for logout</p>
        <h2 id="error-handling-flow">Error Handling Flow</h2>
        <div class="mermaid">
        graph LR
            Request["HTTP Request"]
            Valid{Valid DTO?}
            Auth{Authorized?}
            Service["Execute Service"]
            Error["Handle Exception"]
            Response["HTTP Response"]

            Request --> Valid
            Valid -->|No| Error
            Valid -->|Yes| Auth
            Auth -->|No| Error
            Auth -->|Yes| Service
            Service -->|Exception| Error
            Error --> Response
            Response -->|4xx/5xx| Client["Client"]

            style Valid fill:#fff59d
            style Auth fill:#fff59d
            style Error fill:#ef9a9a
            style Response fill:#a5d6a7
        </div>
        <p><strong>Error Mapping:</strong> -
        <code>IllegalArgumentException</code> ‚Üí 400 Bad Request -
        <code>NoSuchElementException</code> ‚Üí 404 Not Found -
        <code>IllegalStateException</code> ‚Üí 409 Conflict -
        <code>AccessDeniedException</code> ‚Üí 403 Forbidden - Handled by
        <code>GlobalExceptionHandler</code></p>
        <h2 id="best-practices">Best Practices</h2>
        <h3 id="lean-controllers">1. <strong>Lean
        Controllers</strong></h3>
        <p>Controllers should only handle HTTP concerns. Complex
        business logic belongs in the service layer.</p>
        <div class="sourceCode" id="cb7"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ‚úÖ Good - Controller delegates to service</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">ok</span><span class="op">(</span>supplierService<span class="op">.</span><span class="fu">create</span><span class="op">(</span>dto<span class="op">));</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">// ‚ùå Bad - Business logic in controller</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>dto<span class="op">.</span><span class="fu">getName</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;bad&quot;</span><span class="op">))</span> <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">();</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... more business logic ...</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h3 id="consistent-response-structure">2. <strong>Consistent
        Response Structure</strong></h3>
        <p>All endpoints return <code>ResponseEntity&lt;DTO&gt;</code>
        for consistent response handling and status code control.</p>
        <h3 id="security-first-authorization">3. <strong>Security-First
        Authorization</strong></h3>
        <p>Always use <code>@PreAuthorize</code> for sensitive
        operations. Never assume user is authorized.</p>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PreAuthorize</span><span class="op">(</span><span class="st">&quot;hasRole(&#39;ADMIN&#39;)&quot;</span><span class="op">)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">@DeleteMapping</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">Void</span><span class="op">&gt;</span> <span class="fu">delete</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> id<span class="op">)</span> <span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code></pre></div>
        <h3 id="validation-at-boundary">4. <strong>Validation at
        Boundary</strong></h3>
        <p>Use <code>@Valid</code> on all user-submitted data. Never
        trust client input.</p>
        <h3 id="proper-http-status-codes">5. <strong>Proper HTTP Status
        Codes</strong></h3>
        <ul>
        <li>Create: <code>201 CREATED</code> with Location header</li>
        <li>Update: <code>200 OK</code> or
        <code>204 NO CONTENT</code></li>
        <li>Delete: <code>204 NO CONTENT</code></li>
        <li>Error: Appropriate 4xx or 5xx code</li>
        </ul>
        <h3 id="uri-resource-location">6. <strong>URI Resource
        Location</strong></h3>
        <p>When creating resources, return Location header pointing to
        created resource.</p>
        <div class="sourceCode" id="cb9"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span>SupplierDTO<span class="op">&gt;</span> <span class="fu">create</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> CreateSupplierDTO dto<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    SupplierDTO created <span class="op">=</span> supplierService<span class="op">.</span><span class="fu">create</span><span class="op">(</span>dto<span class="op">);</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">URI</span> location <span class="op">=</span> ServletUriComponentsBuilder<span class="op">.</span><span class="fu">fromCurrentRequest</span><span class="op">()</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">buildAndExpand</span><span class="op">(</span>created<span class="op">.</span><span class="fu">getId</span><span class="op">())</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">toUri</span><span class="op">();</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">created</span><span class="op">(</span>location<span class="op">).</span><span class="fu">body</span><span class="op">(</span>created<span class="op">);</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <h2 id="requestresponse-lifecycle">Request/Response
        Lifecycle</h2>
        <pre><code>1. HTTP Request arrives at Spring DispatcherServlet
   ‚Üì
2. Request routing matches URL pattern to controller method
   ‚Üì
3. Spring Security checks @PreAuthorize annotation
   ‚Üì
4. @Valid triggers DTO field validation
   ‚Üì
5. Jackson deserializes request body JSON ‚Üí DTO
   ‚Üì
6. Controller method executes, calls service layer
   ‚Üì
7. Service returns domain DTO
   ‚Üì
8. Jackson serializes DTO ‚Üí JSON response body
   ‚Üì
9. Controller builds ResponseEntity with status code
   ‚Üì
10. HTTP Response returned to client</code></pre>
        <h2 id="integration-with-other-layers">Integration with Other
        Layers</h2>
        <pre><code>Controller Layer
       ‚Üì
Service Layer (Business Logic)
       ‚Üì
Repository Layer (Data Access)
       ‚Üì
Database</code></pre>
        <p><strong>Interaction Pattern:</strong> - Controller receives
        HTTP request + DTO - Controller calls service method (no
        business logic here) - Service performs validation, business
        logic, transactions - Service calls repository for data
        persistence - Service returns result to controller - Controller
        builds HTTP response</p>
        <h2 id="testing-controller-layer">Testing Controller Layer</h2>
        <p>Controllers are tested via integration tests: - Use
        <code>@SpringBootTest</code> with mock databases - Test endpoint
        routing, status codes, response structure - Mock service layer
        to isolate controller logic - Verify error handling and
        exception mapping</p>
        <p><strong>Example:</strong></p>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootTest</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SupplierControllerTest <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@MockBean</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> SupplierService supplierService<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">testCreateSupplier</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Test controller endpoint</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        mockMvc<span class="op">.</span><span class="fu">perform</span><span class="op">(</span><span class="fu">post</span><span class="op">(</span><span class="st">&quot;/api/suppliers&quot;</span><span class="op">)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON</span><span class="op">)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">content</span><span class="op">(</span><span class="fu">jsonOf</span><span class="op">(</span><span class="kw">new</span> <span class="fu">CreateSupplierDTO</span><span class="op">(</span><span class="kw">...</span><span class="op">))))</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">andExpect</span><span class="op">(</span><span class="fu">status</span><span class="op">().</span><span class="fu">isCreated</span><span class="op">());</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
        <hr />
        <p><a href="./overview.html">‚¨ÖÔ∏è Back to Layers Overview</a></p>
      </article>
    </section>
  </main>

  <footer class="footer">
    Smart Supply Pro ¬∑ Generated by Docs Pipeline
  </footer>

  <!-- Mermaid for diagrams in ```mermaid``` blocks -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>
</body>
</html>
