paths:
  /api/me:
    get:
      tags:
        - Auth
      summary: Get authenticated user profile
      description: |
        Returns the current authenticated user's profile information including email,
        full name, role, and profile picture URL from OAuth2 provider.
        
        User data is loaded from the database based on OAuth2 email claim.
      operationId: getCurrentUser
      security:
        - oauth2: [openid, profile, email]
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '../../schemas/auth/auth.yaml#/components/schemas/AppUserProfileDTO'
              examples:
                admin:
                  summary: Admin user profile
                  value:
                    email: admin@example.com
                    fullName: Admin User
                    role: ADMIN
                    pictureUrl: https://lh3.googleusercontent.com/a/example123
                user:
                  summary: Regular user profile
                  value:
                    email: user@example.com
                    fullName: John Doe
                    role: USER
                    pictureUrl: https://lh3.googleusercontent.com/a/example456
        '401':
          $ref: '../../responses/errors.yaml#/components/responses/Unauthorized'
        '404':
          description: User not found in database
          content:
            application/json:
              schema:
                $ref: '../../schemas/common/common.yaml#/components/schemas/ErrorResponse'
              example:
                message: User not found
                status: 404
                timestamp: '2025-11-18T10:30:00Z'

  /api/me/authorities:
    get:
      tags:
        - Auth
      summary: Get user authorities
      description: |
        Returns the list of granted authorities (roles and permissions) for the
        authenticated user. Used for frontend authorization checks.
        
        Authorities are returned as sorted strings (e.g., ROLE_USER, ROLE_ADMIN).
      operationId: getUserAuthorities
      security:
        - oauth2: [openid, profile, email]
      responses:
        '200':
          description: List of user authorities
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example:
                  - ROLE_USER
                  - ROLE_ADMIN
        '401':
          $ref: '../../responses/errors.yaml#/components/responses/Unauthorized'

  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: API logout endpoint
      description: |
        Programmatic logout endpoint for API clients (SPAs, mobile apps).
        
        **What it does:**
        - Invalidates the Spring Security session
        - Expires JSESSIONID and SESSION cookies
        - Returns 204 No Content
        
        **Cookie settings:**
        - HttpOnly: true (prevents JavaScript access)
        - Secure: true (HTTPS only)
        - SameSite: None (cross-origin support)
        - MaxAge: 0 (immediate expiration)
        
        **Note:** Browser clients should prefer the standard POST /logout endpoint.
      operationId: apiLogout
      security:
        - oauth2: [openid]
      responses:
        '204':
          description: Logout successful, session invalidated
          headers:
            Set-Cookie:
              description: Expired session cookies
              schema:
                type: string
              examples:
                jsessionid:
                  value: JSESSIONID=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0
                session:
                  value: SESSION=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0
        '401':
          $ref: '../../responses/errors.yaml#/components/responses/Unauthorized'
