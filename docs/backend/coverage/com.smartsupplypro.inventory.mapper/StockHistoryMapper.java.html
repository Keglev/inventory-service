<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StockHistoryMapper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Inventory Service</a> &gt; <a href="index.source.html" class="el_package">com.smartsupplypro.inventory.mapper</a> &gt; <span class="el_source">StockHistoryMapper.java</span></div><h1>StockHistoryMapper.java</h1><pre class="source lang-java linenums">package com.smartsupplypro.inventory.mapper;

import com.smartsupplypro.inventory.dto.StockHistoryDTO;
import com.smartsupplypro.inventory.model.StockHistory;
import com.smartsupplypro.inventory.enums.StockChangeReason;

/**
 * Enterprise entity-DTO mapping utility for stock history audit trails with enum transformation.
 * 
 * &lt;p&gt;Provides specialized transformation between {@link StockHistory} entities and 
 * {@link StockHistoryDTO} data transfer objects with audit-specific business logic
 * including enum conversions and temporal data preservation.&lt;/p&gt;
 * 
 * &lt;p&gt;&lt;strong&gt;Enterprise Audit Features:&lt;/strong&gt;&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;&lt;strong&gt;Enum Transformation:&lt;/strong&gt; Safe StockChangeReason enum to string conversion&lt;/li&gt;
 *   &lt;li&gt;&lt;strong&gt;Temporal Integrity:&lt;/strong&gt; Preserves precise timestamp and audit trails&lt;/li&gt;
 *   &lt;li&gt;&lt;strong&gt;Audit Metadata:&lt;/strong&gt; Maintains user tracking and change attribution&lt;/li&gt;
 *   &lt;li&gt;&lt;strong&gt;Historical Context:&lt;/strong&gt; Supports price snapshots and quantity tracking&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * &lt;p&gt;&lt;strong&gt;Enterprise Architecture:&lt;/strong&gt; This mapper serves the auditing and compliance
 * subsystem, enabling historical data analysis, stock movement tracking, and regulatory
 * reporting while maintaining data lineage and change attribution.&lt;/p&gt;
 */
public final class StockHistoryMapper {

    /**
     * Private constructor to prevent instantiation of utility class.
     * 
     * @throws UnsupportedOperationException if instantiation is attempted
     */
<span class="nc" id="L33">    private StockHistoryMapper() {</span>
<span class="nc" id="L34">        throw new UnsupportedOperationException(&quot;Utility class - no instances allowed&quot;);</span>
    }

    /**
     * Transforms a stock history entity to a data transfer object with audit information.
     *
     * &lt;p&gt;&lt;strong&gt;Enterprise Audit Transformation:&lt;/strong&gt;&lt;/p&gt;
     * &lt;ul&gt;
     *   &lt;li&gt;&lt;strong&gt;Enum String Conversion:&lt;/strong&gt; Converts StockChangeReason to readable format&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Temporal Preservation:&lt;/strong&gt; Maintains precise audit timestamps&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Change Attribution:&lt;/strong&gt; Preserves user and reason tracking&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Historical Snapshot:&lt;/strong&gt; Captures price and quantity at time of change&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * &lt;p&gt;&lt;strong&gt;Compliance Support:&lt;/strong&gt; This transformation enables audit trail reporting,
     * regulatory compliance, and historical analysis by converting internal enum values to
     * human-readable strings for external systems and reports.&lt;/p&gt;
     *
     * @param history the stock history entity from audit subsystem, must not be null
     * @return DTO optimized for audit reports and compliance documentation
     * @implNote Enum transformation ensures backward compatibility with external systems
     */
    public static StockHistoryDTO toDTO(StockHistory history) {
<span class="nc bnc" id="L57" title="All 2 branches missed.">        if (history == null) {</span>
<span class="nc" id="L58">            return null;</span>
        }
        
        // Transform enum safely for external system compatibility
<span class="nc" id="L62">        String reasonString = transformEnumSafely(history.getReason());</span>
        
<span class="nc" id="L64">        return StockHistoryDTO.builder()</span>
<span class="nc" id="L65">                .id(history.getId())</span>
<span class="nc" id="L66">                .itemId(history.getItemId())</span>
<span class="nc" id="L67">                .change(history.getChange())</span>
<span class="nc" id="L68">                .reason(reasonString)</span>
<span class="nc" id="L69">                .createdBy(history.getCreatedBy())</span>
<span class="nc" id="L70">                .timestamp(history.getTimestamp())</span>
<span class="nc" id="L71">                .priceAtChange(history.getPriceAtChange())</span>
<span class="nc" id="L72">                .build();</span>
    }

    /**
     * Transforms a stock history DTO back to an entity for audit persistence operations.
     *
     * &lt;p&gt;&lt;strong&gt;Audit Entity Reconstruction:&lt;/strong&gt;&lt;/p&gt;
     * &lt;ul&gt;
     *   &lt;li&gt;&lt;strong&gt;String to Enum Conversion:&lt;/strong&gt; Safely converts reason strings to StockChangeReason&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Audit Trail Persistence:&lt;/strong&gt; Prepares entity for compliance storage&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Test Data Support:&lt;/strong&gt; Enables programmatic audit record creation&lt;/li&gt;
     *   &lt;li&gt;&lt;strong&gt;Temporal Accuracy:&lt;/strong&gt; Preserves precise timestamps for regulatory compliance&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * &lt;p&gt;&lt;strong&gt;Enterprise Usage:&lt;/strong&gt; Primarily used for test data preparation and internal
     * service interactions where audit records need to be reconstructed from DTO format. The
     * enum conversion includes validation to ensure data integrity in audit subsystems.&lt;/p&gt;
     *
     * @param dto the audit DTO from external systems, must not be null
     * @return entity ready for audit persistence and compliance storage
     * @throws IllegalArgumentException if reason string cannot be converted to valid enum
     * @implNote Enum conversion uses valueOf() for strict validation of audit reasons
     */
    public static StockHistory toEntity(StockHistoryDTO dto) {
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (dto == null) {</span>
<span class="nc" id="L97">            return null;</span>
        }
        
        // Convert enum string with validation and error handling
<span class="nc" id="L101">        StockChangeReason reason = parseEnumSafely(dto.getReason());</span>
        
<span class="nc" id="L103">        return StockHistory.builder()</span>
<span class="nc" id="L104">                .id(dto.getId())</span>
<span class="nc" id="L105">                .itemId(dto.getItemId())</span>
<span class="nc" id="L106">                .change(dto.getChange())</span>
<span class="nc" id="L107">                .reason(reason)</span>
<span class="nc" id="L108">                .createdBy(dto.getCreatedBy())</span>
<span class="nc" id="L109">                .timestamp(dto.getTimestamp())</span>
<span class="nc" id="L110">                .priceAtChange(dto.getPriceAtChange())</span>
<span class="nc" id="L111">                .build();</span>
    }
    
    /**
     * Transforms StockChangeReason enum to string safely for external system compatibility.
     *
     * &lt;p&gt;&lt;strong&gt;External System Integration:&lt;/strong&gt; Converts internal enum values to
     * stable string representations for API consumers and reporting systems.&lt;/p&gt;
     *
     * @param reason the enum value (may be null)
     * @return string representation or null if enum is null
     */
    private static String transformEnumSafely(StockChangeReason reason) {
<span class="nc bnc" id="L124" title="All 2 branches missed.">        return reason != null ? reason.name() : null;</span>
    }
    
    /**
     * Parses string to StockChangeReason enum with validation for audit integrity.
     *
     * &lt;p&gt;&lt;strong&gt;Validation Strategy:&lt;/strong&gt; Uses strict enum validation to ensure only
     * valid audit reasons are persisted. Throws IllegalArgumentException for invalid values.&lt;/p&gt;
     *
     * @param reasonString the string value (may be null)
     * @return enum value or null if string is null
     * @throws IllegalArgumentException if string cannot be converted to valid enum
     */
    private static StockChangeReason parseEnumSafely(String reasonString) {
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (reasonString == null) {</span>
<span class="nc" id="L139">            return null;</span>
        }
        try {
<span class="nc" id="L142">            return StockChangeReason.valueOf(reasonString);</span>
<span class="nc" id="L143">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L144">            throw new IllegalArgumentException(</span>
                &quot;Invalid stock change reason: &quot; + reasonString + 
<span class="nc" id="L146">                &quot;. Valid values: &quot; + java.util.Arrays.toString(StockChangeReason.values()), e);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>